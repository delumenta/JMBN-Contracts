<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JMBN Members</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png"
      href="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png"
      sizes="32x32">

<style>
:root{
  --bg:#000; --panel:#0b0b0b; --card:#0c0c0c; --border:#d6b44c; --accent:#f2d675;
  --text:#f7f1d0; --muted:#c9b06a; --bad:#ff6b6b;
  --fs-base:14px; --fs-small:11px; --fs-h1:clamp(18px,2.2vw,22px);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  background:
    radial-gradient(1200px 900px at 15% -10%, rgba(242,214,117,.08), transparent 60%),
    radial-gradient(900px 700px at 120% 110%, rgba(214,180,76,.05), transparent 60%),
    #000;
  color:var(--text); font-family:'Play',sans-serif; margin:0; padding:14px; letter-spacing:.25px; font-size:var(--fs-base)
}

/* ===== Shared header (mount or fallback) ===== */
.brand{display:flex;align-items:center;gap:10px;margin:0 0 8px;border-bottom:1px solid var(--border);padding-bottom:6px}
.brand-logo{width:44px;height:44px;object-fit:contain;filter:drop-shadow(0 0 4px rgba(242,214,117,.25))}
.brand h1{font-weight:700;font-size:var(--fs-h1);color:var(--accent);margin:0}
.nav{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:6px 0 10px}
.nav-btn{
  --ring:#d6b44c;
  position:relative;display:inline-flex;align-items:center;justify-content:center;
  padding:7px 14px;border:1px solid var(--ring);border-radius:999px;
  background:linear-gradient(180deg,#0c0c0c,#060606);
  color:var(--accent);text-decoration:none;font-weight:700;letter-spacing:.2px;
  transition:.15s ease;box-shadow:inset 0 0 0 1px rgba(214,180,76,.12)
}
.nav-btn:hover{transform:translateY(-1px);box-shadow:0 0 12px rgba(214,180,76,.25)}
.nav-btn.active{
  color:#000;
  background:
    radial-gradient(120% 120% at 80% -20%, rgba(255,255,255,.32), rgba(255,255,255,0) 40%),
    linear-gradient(180deg,#f2d675,#e7c760);
  border-color:var(--ring);
  box-shadow:0 0 20px rgba(214,180,76,.45), inset 0 1px 0 rgba(255,255,255,.25), inset 0 -1px 0 rgba(0,0,0,.12);
}

/* ===== Panel / controls ===== */
.panel{background:#0b0b0b;border:1px solid var(--border);border-radius:12px;padding:12px;box-shadow:0 0 18px rgba(214,180,76,.22)}
.controls{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;margin-bottom:8px}
@media (max-width:720px){.controls{grid-template-columns:1fr auto}}
input,button{
  background:#0a0a0a;border:1px solid var(--border);border-radius:999px;padding:10px 12px;
  color:var(--text);font-size:13px;font-family:'Play';outline:none
}
input::placeholder{color:var(--muted)}
button{cursor:pointer;background:linear-gradient(180deg,#0c0c0c,#060606)}
button:hover{background:var(--accent);color:#000}
.pill{display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:9999px;padding:6px 10px;font-weight:700;color:var(--accent);}

/* ===== Table ===== */
.tableWrap{border:1px solid var(--border);border-radius:12px;overflow:auto;max-height:70vh}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border-bottom:1px solid rgba(214,180,76,.3);padding:10px;text-align:left;vertical-align:middle}
th{color:var(--accent);background:#080808;font-weight:600;position:sticky;top:0;z-index:1}
tr:nth-child(even){background:#111}
tr:hover{background:rgba(214,180,76,.08)}
.small{font-size:11px;color:var(--muted)}

/* Chips */
.rank-chip{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--border);border-radius:999px;padding:4px 10px}
.rank-chip img{width:16px;height:16px;object-fit:contain;filter:drop-shadow(0 0 2px rgba(242,214,117,.2))}
.spec-chip{display:inline-flex;border:1px solid var(--border);border-radius:999px;padding:3px 8px;color:var(--muted)}
.cat-chip{display:inline-flex;border:1px solid var(--border);border-radius:999px;padding:3px 10px;font-weight:700;color:var(--accent)}

/* Certification chips */
.badge{display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted);gap:6px}
.badge.cert{color:var(--accent);border-color:rgba(214,180,76,.65);font-weight:700;font-size:11px;margin:2px 4px 0 0}

/* Buttons */
.btn-view{padding:7px 12px;border-radius:10px}

/* Footer note */
.note{margin-top:8px;color:var(--muted);font-size:12px}

/* ===== Modal ===== */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:9999}
.modal{background:#0b0b0b;border:1px solid var(--border);border-radius:12px;padding:16px;width:95%;max-width:820px;box-shadow:0 0 25px rgba(214,180,76,.3)}
.modal h2{margin:0 0 6px;color:var(--accent)}
.modal .tabs{display:flex;gap:8px;margin:8px 0 12px}
.modal .tab{padding:8px 12px;border:1px solid var(--border);border-radius:999px;cursor:pointer}
.modal .tab.active{background:var(--accent);color:#000}
.modal .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
@media (max-width:720px){.modal .grid{grid-template-columns:1fr}}
.modal .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.modal .close{float:right}
</style>
</head>
<body>

<!-- ===== HEADER MOUNT ANCHOR ===== -->
<div id="header-mount" aria-live="polite"></div>

<!-- ===== CONTENT ===== -->
<div class="panel" style="margin-top:8px">
  <div class="controls">
    <input id="q" placeholder="Search handle, rank, specialization, certification…">
    <span id="count" class="pill">0 members</span>
  </div>

  <div class="tableWrap">
    <table>
      <thead>
        <tr>
          <th style="min-width:160px">Handle</th>
          <th style="min-width:140px">Rank Category</th>
          <th style="min-width:180px">Current Rank</th>
          <th style="min-width:160px">Specialization</th>
          <th style="min-width:220px">Certification</th>
          <th style="width:100px">Actions</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <div class="note">Attendance counts only missions with status <b>Success</b> / <b>Fail</b> / <b>Abort</b>. Sorted by <b>Rank Category → Specialization → Certification</b>.</div>
</div>

<!-- ===== PROFILE MODAL ===== -->
<div class="modal-bg" id="profileBG">
  <div class="modal">
    <button class="close" id="profileClose">Close</button>
    <h2 id="pHandle">Member</h2>
    <div class="tabs">
      <div class="tab active" data-tab="overview">Overview</div>
      <div class="tab" data-tab="missions">Missions</div>
      <div class="tab" data-tab="quals">Certifications</div>
      <div class="tab" data-tab="notes">Notes</div>
    </div>
    <div id="tab-overview">
      <div class="grid">
        <div>
          <div class="small">Rank Category</div>
          <div class="row"><span id="pCat" class="cat-chip"></span></div>
        </div>
        <div>
          <div class="small">Rank</div>
          <div class="row"><span id="pRank" class="rank-chip"></span></div>
        </div>
        <div>
          <div class="small">Specialization</div>
          <div class="row"><span id="pSpec" class="spec-chip"></span></div>
        </div>
        <div>
          <div class="small">Certifications</div>
          <div class="row" id="pCerts"></div>
        </div>
        <div>
          <div class="small">Joined</div>
          <div id="pJoined">—</div>
        </div>
      </div>
    </div>
    <div id="tab-missions" style="display:none">
      <div class="small">Recent missions (sample placeholder)</div>
      <div class="row"><span class="badge">Success: <b>0</b></span><span class="badge">Fail: <b>0</b></span><span class="badge">Abort: <b>0</b></span></div>
    </div>
    <div id="tab-quals" style="display:none">
      <div id="pCertList" class="row"></div>
    </div>
    <div id="tab-notes" style="display:none">
      <div class="small">Leader notes</div>
      <div id="pNotes">—</div>
    </div>
  </div>
</div>

<script>
/* ===== Header mount (shared header.html with fallback) ===== */
(async function mountHeader(){
  const mount = document.getElementById('header-mount');
  const here = (location.pathname.split('/').pop() || 'index.html').toLowerCase();

  function highlightNav(root){
    root.querySelectorAll('.nav-btn').forEach(a=>{
      const href = (a.getAttribute('href')||'').toLowerCase();
      if(href && here.endsWith(href)){ a.classList.add('active'); a.setAttribute('aria-current','page'); }
      if(here==='index.html' && (href===''||href==='#')){ a.classList.add('active'); a.setAttribute('aria-current','page'); }
      if(/member/.test(here) && /member/.test(href)){ a.classList.add('active'); a.setAttribute('aria-current','page'); }
    });
  }

  try{
    const res = await fetch('header.html', {cache:'no-cache'});
    if(res.ok){
      mount.innerHTML = await res.text();
      highlightNav(mount);
      return;
    }
  }catch(e){}

  // Fallback header
  mount.innerHTML = `
    <div class="brand">
      <img class="brand-logo" src="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png/v1/fill/w_66,h_66,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/0_New_JMBN_Logo_Gold.png" alt="JMBN">
      <h1>JMBN</h1>
    </div>
    <nav class="nav">
      <a class="nav-btn" href="index.html">Manifest</a>
      <a class="nav-btn" href="hangar.html">Hangar</a>
      <a class="nav-btn" href="loadout.html">Loadout</a>
      <a class="nav-btn" href="components.html">Components</a>
      <a class="nav-btn" href="contracts.html">Contracts</a>
      <a class="nav-btn" href="mission-log.html">Mission Log</a>
      <a class="nav-btn" href="member.html">Member</a>
    </nav>`;
  highlightNav(mount);
})();

/* ===== Data (replace with Supabase rows; expects rank_category + certifications[]) ===== */
let members = [
  // rank_category should be exactly "Enlisted" | "Warrant" | "Officer"
  {handle:'Ashenshrike', rank_category:'Enlisted', rank:'Unranked', spec:null, certifications:[], joined_at:null, notes:''},
  {handle:'Delumenta',   rank_category:'Officer',  rank:'Ensign (O-1)', spec:'Gunnery', certifications:['VBSS','Combat Control'], joined_at:'2025-01-05', notes:'Reliable turret ops'},
  {handle:'Derek',       rank_category:'Enlisted', rank:'Unranked', spec:null, certifications:[], joined_at:null, notes:''},
  {handle:'Floatintiger',rank_category:'Enlisted', rank:'Unranked', spec:null, certifications:[], joined_at:null, notes:''},
  {handle:'Jeneral',     rank_category:'Warrant',  rank:'Unranked', spec:null, certifications:['Pararescue'], joined_at:null, notes:''},
  {handle:'Jesric',      rank_category:'Enlisted', rank:'Unranked', spec:null, certifications:[], joined_at:null, notes:''},
  {handle:'Nomad',       rank_category:'Enlisted', rank:'Unranked', spec:null, certifications:['Medic'], joined_at:null, notes:''},
  {handle:'Politico',    rank_category:'Enlisted', rank:'Unranked', spec:null, certifications:[], joined_at:null, notes:''},
];

/* ===== Helpers ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const esc = s => { const d=document.createElement('div'); d.textContent = s ?? ''; return d.innerHTML; };
function fmtJoined(d){
  if(!d) return '—';
  const dt = new Date(d);
  if(Number.isNaN(dt)) return '—';
  return dt.toLocaleDateString();
}

/* ===== Sort: Rank Category → Specialization → Certification ===== */
const CAT_ORDER = { 'Enlisted':0, 'Warrant':1, 'Officer':2 };
function byRankCategorySpecCert(a,b){
  // 1) Rank Category weight
  const aw = CAT_ORDER[a.rank_category] ?? 99;
  const bw = CAT_ORDER[b.rank_category] ?? 99;
  if(aw !== bw) return aw - bw;
  // 2) Specialization (alpha, empty last)
  const as = (a.spec||'').toLowerCase();
  const bs = (b.spec||'').toLowerCase();
  if(as !== bs) return (as||'zzzz').localeCompare(bs||'zzzz');
  // 3) Certification (alpha by joined string; empty last)
  const ac = (Array.isArray(a.certifications)?a.certifications.join('|'):'').toLowerCase();
  const bc = (Array.isArray(b.certifications)?b.certifications.join('|'):'').toLowerCase();
  return (ac||'zzzz').localeCompare(bc||'zzzz');
}

/* ===== Render ===== */
function rankChip(r){
  if(!r || r.toLowerCase()==='unranked') return `<span class="small">Unranked</span>`;
  return `<span class="rank-chip"><img alt="" src="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png" /> ${esc(r)}</span>`;
}
function specChip(s){ return s ? `<span class="spec-chip">${esc(s)}</span>` : `<span class="small">—</span>`; }
function catChip(c){ return c ? `<span class="cat-chip">${esc(c)}</span>` : `<span class="small">—</span>`; }
function certChips(arr){
  const a = Array.isArray(arr)?arr:[];
  if(!a.length) return `<span class="small">—</span>`;
  return a.map(c=>`<span class="badge cert">${esc(c)}</span>`).join('');
}

function render(){
  const q = ($('#q').value||'').toLowerCase().trim();

  // Search
  let arr = members.slice();
  if(q){
    arr = arr.filter(m=>{
      const bag = `${m.handle||''} ${m.rank_category||''} ${m.rank||''} ${m.spec||''} ${(m.certifications||[]).join(' ')}`.toLowerCase();
      return bag.includes(q);
    });
  }

  // Sort: Rank Category → Specialization → Certification
  arr.sort(byRankCategorySpecCert);

  // Count
  $('#count').textContent = `${arr.length} member${arr.length===1?'':'s'}`;

  // Rows
  $('#rows').innerHTML = arr.map(m=>`
    <tr>
      <td>${esc(m.handle)}</td>
      <td>${catChip(m.rank_category)}</td>
      <td>${rankChip(m.rank)}</td>
      <td>${specChip(m.spec)}</td>
      <td>${certChips(m.certifications)}</td>
      <td><button class="btn-view" data-view="${esc(m.handle)}">View</button></td>
    </tr>
  `).join('');

  // Hook view buttons
  $$('#rows [data-view]').forEach(b=>{
    b.onclick = ()=> openProfile(arr.find(x=>x.handle===b.dataset.view));
  });
}

/* ===== Profile modal ===== */
const profileBG = $('#profileBG');
function openProfile(m){
  if(!m) return;
  $('#pHandle').textContent = m.handle || 'Member';
  $('#pCat').innerHTML = catChip(m.rank_category);
  $('#pRank').innerHTML = rankChip(m.rank);
  $('#pSpec').innerHTML = specChip(m.spec);
  $('#pJoined').textContent = fmtJoined(m.joined_at);
  $('#pNotes').textContent = m.notes || '—';
  $('#pCerts').innerHTML = certChips(m.certifications);
  $('#pCertList').innerHTML = certChips(m.certifications);
  showTab('overview');
  profileBG.style.display = 'flex';
}
function closeProfile(){ profileBG.style.display='none'; }
$('#profileClose').onclick = closeProfile;
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeProfile(); });
profileBG.addEventListener('click', e=>{ if(e.target===profileBG) closeProfile(); });

function showTab(name){
  $$('.modal .tab').forEach(t=>t.classList.toggle('active', t.dataset.tab===name));
  ['overview','missions','quals','notes'].forEach(k=>{
    $('#tab-'+k).style.display = (k===name)?'block':'none';
  });
}
$$('.modal .tab').forEach(t=>t.onclick=()=>showTab(t.dataset.tab));

/* ===== Events ===== */
$('#q').addEventListener('input', render);

/* Init */
render();
</script>
</body>
</html>
