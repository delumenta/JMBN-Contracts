<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JMBN Paygrades — Holo HUD</title>

<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png" sizes="32x32">

<style>
:root{
  --bg:#000; --panel:#0b0b0b; --panel2:#0a0a0a; --card:#0c0c0c;
  --border:#d6b44c; --accent:#f2d675; --text:#f7f1d0; --muted:#c9b06a;
  --hud:#00ffe0; --hud-dim:rgba(0,255,224,.2);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; padding:14px; color:var(--text);
  background:
    radial-gradient(1200px 900px at 15% -10%, rgba(242,214,117,.07), transparent 60%),
    radial-gradient(900px 700px at 120% 110%, rgba(214,180,76,.05), transparent 60%),
    #000;
  font-family:'Play',system-ui,sans-serif; letter-spacing:.25px; font-size:14px;
}

/* ===== Brand + HUD Bar ===== */
.brand{display:flex;align-items:center;gap:10px;margin:0 0 8px;border-bottom:1px solid var(--border);padding-bottom:6px}
.brand-logo{width:44px;height:44px;object-fit:contain;filter:drop-shadow(0 0 4px rgba(242,214,117,.25))}
.brand h1{margin:0;color:var(--accent);font-size:22px}

.hudbar{
  position:relative; display:flex; align-items:center; gap:10px;
  background:linear-gradient(180deg,#0b0b0b,#070707);
  border:1px solid var(--border); border-radius:10px; padding:8px 10px; margin:8px 0 12px;
  box-shadow:0 0 18px rgba(214,180,76,.14), inset 0 0 0 1px rgba(214,180,76,.10);
  overflow:hidden;
}
.hudbar::after{
  content:""; position:absolute; inset:0;
  background:repeating-linear-gradient(90deg, transparent 0 24px, rgba(255,255,255,.04) 24px 25px);
  pointer-events:none;
}
.hud-led{width:8px;height:8px;border-radius:50%; background:#45ffb7; box-shadow:0 0 10px #45ffb7}
.hud-scroll{font-family:'Share Tech Mono',monospace; color:var(--hud); opacity:.9; white-space:nowrap; overflow:hidden}
.hud-scroll span{display:inline-block; padding-left:100%; animation:marq 14s linear infinite}
@keyframes marq{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}

/* ===== Nav ===== */
.nav{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:0 0 10px}
.nav-btn{
  --ring:#d6b44c;
  display:inline-flex;align-items:center;justify-content:center;
  padding:7px 14px;border:1px solid var(--ring);border-radius:999px;
  background:linear-gradient(180deg,#0c0c0c,#060606);
  color:var(--accent);text-decoration:none;font-weight:700;letter-spacing:.2px;
  box-shadow:inset 0 0 0 1px rgba(214,180,76,.12);
  transition:transform .15s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
}
.nav-btn:hover{transform:translateY(-1px);box-shadow:0 0 12px rgba(214,180,76,.25)}
.nav-btn.active{color:#000;background:linear-gradient(180deg,#f2d675,#e7c760);border-color:var(--ring)}

/* ===== Layout ===== */
.wrap{display:grid; grid-template-columns:1fr 360px; gap:12px}
@media (max-width:1100px){ .wrap{ grid-template-columns:1fr } }
.panel{background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:12px; box-shadow:0 0 18px rgba(214,180,76,.14)}
.panel h2{margin:0 0 8px; color:var(--accent); font-size:16px}

/* ===== Controls ===== */
.tools{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
input[type="search"], input[type="number"]{
  background:#0a0a0a; border:1px solid var(--border); border-radius:10px; padding:9px 10px; color:var(--text); min-width:220px
}
button{
  padding:8px 12px; border-radius:10px; background:linear-gradient(180deg,#0c0c0c,#060606);
  color:var(--accent); border:1px solid var(--border); cursor:pointer; font-weight:700; transition:.2s;
  font-family:'Play',sans-serif;
}
button:hover{background:var(--accent); color:#000}
.btn-ghost{background:transparent}
.small{font-size:12px; color:var(--muted)}

/* ===== Holo Grid ===== */
.grid{
  display:grid; gap:10px;
  grid-template-columns: repeat(3, minmax(280px, 1fr));
}
@media (max-width:1280px){ .grid{ grid-template-columns: repeat(2, minmax(240px, 1fr)); } }
@media (max-width:860px){ .grid{ grid-template-columns: 1fr; } }

.card{
  position:relative; background:linear-gradient(180deg,#0b0b0b,#080808);
  border:1px solid var(--border); border-radius:14px; padding:10px;
  box-shadow:0 0 24px rgba(214,180,76,.14), inset 0 0 0 1px rgba(214,180,76,.08);
  overflow:hidden; transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease;
}
.card::before{
  content:""; position:absolute; inset:0; border-radius:inherit;
  background: radial-gradient(400px 200px at 110% -10%, var(--hud-dim), transparent 60%);
  pointer-events:none;
}
.card:hover{
  transform:translateY(-2px);
  box-shadow:0 0 28px rgba(0,255,224,.25), 0 0 24px rgba(214,180,76,.2);
  border-color:#9fe8d9;
}
.rank-line{display:flex; align-items:center; justify-content:space-between; gap:8px}
.rank-name{color:var(--accent); font-weight:800; font-size:16px}
.rank-code{font-family:'Share Tech Mono',monospace; color:var(--hud)}
.meta{display:flex; gap:6px; flex-wrap:wrap; margin-top:4px}
.badge{border:1px solid var(--border); border-radius:999px; padding:2px 8px; font-size:11px; color:var(--muted); background:#0c0c0c}
.values{display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px}
.v{background:var(--panel2); border:1px solid rgba(214,180,76,.3); border-radius:10px; padding:8px}
.v label{display:block; color:#c9b06a; font-size:11px; margin-bottom:2px}
.v strong{display:block; font-family:'Share Tech Mono',monospace; font-size:16px; color:#f7f1d0}
.actions{display:flex; gap:6px; margin-top:8px}

/* ===== Scanner (right) ===== */
.scan{position:relative}
.scan .hud{
  position:absolute; inset:0; border-radius:10px; pointer-events:none;
  background:linear-gradient(180deg, rgba(0,255,224,.06), transparent 40%); mix-blend-mode:screen;
}
.kpis{display:grid; grid-template-columns:repeat(2,1fr); gap:8px}
.kpi{background:#0c0c0c; border:1px solid var(--border); border-radius:10px; padding:10px; text-align:center}
.kpi h3{margin:0; color:#c9b06a; font-size:11px; text-transform:uppercase}
.kpi .val{font-weight:800; font-size:18px; color:var(--accent); margin-top:4px}

.scan-block{background:#0b0b0b; border:1px solid var(--border); border-radius:12px; padding:10px; margin-top:10px}
.scan-block h3{margin:0 0 6px; color:var(--accent); font-size:14px}
.row{display:flex; align-items:center; gap:8px; margin-top:6px; flex-wrap:wrap}
.readout{font-family:'Share Tech Mono',monospace; color:var(--hud)}
.list{max-height:36vh; overflow:auto; border:1px solid rgba(214,180,76,.25); border-radius:10px; padding:8px; background:#090909}
.list .li{display:grid; grid-template-columns:1fr auto; gap:6px; padding:6px 0; border-bottom:1px dashed rgba(214,180,76,.2)}
.list .li:last-child{border-bottom:none}
.mono{font-family:'Share Tech Mono',monospace}
</style>
</head>

<body>
  <div class="brand">
    <img class="brand-logo" src="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png" alt="JMBN">
    <h1>JMBN Paygrades — Holo HUD</h1>
  </div>

  <div class="hudbar">
    <div class="hud-led" title="Auth channel active"></div>
    <div class="hud-scroll"><span>// PAYGRADE INTERFACE — FLEET NODE ONLINE — DATA LINK: V_RANK_PAY_CURRENT — STATUS: GREEN — PRESS SIMULATE TO PROJECT MISSION PAYOUTS //</span></div>
  </div>

  <nav class="nav">
    <a class="nav-btn" href="index.html">Manifest</a>
    <a class="nav-btn" href="hangar.html">Hangar</a>
    <a class="nav-btn" href="components.html">Components</a>
    <a class="nav-btn" href="contracts.html">Contracts</a>
    <a class="nav-btn" href="mission-log.html">Mission Log</a>
    <a class="nav-btn active" href="paygrades-holo.html">Paygrades (HUD)</a>
  </nav>

  <div class="wrap">
    <!-- LEFT: Holo grid -->
    <div class="panel">
      <div class="tools">
        <input id="q" type="search" placeholder="Search rank / code / category…">
        <button id="export">Export JSON</button>
        <span class="small" id="countInfo">—</span>
      </div>
      <div id="grid" class="grid"></div>
    </div>

    <!-- RIGHT: Scanner -->
    <div class="panel scan">
      <div class="hud"></div>
      <h2>Finance Scanner</h2>

      <div class="kpis">
        <div class="kpi"><h3>Total Ranks</h3><div class="val" id="kCount">0</div></div>
        <div class="kpi"><h3>Avg Base</h3><div class="val" id="kAvg">—</div></div>
      </div>

      <div class="scan-block">
        <h3>Selected Rank</h3>
        <div class="row"><span class="small">Code:</span> <span id="selCode" class="readout">—</span></div>
        <div class="row"><span class="small">Name:</span> <span id="selName" class="readout">—</span></div>
        <div class="row"><span class="small">Category:</span> <span id="selCat" class="readout">—</span></div>
        <div class="row"><span class="small">Base:</span> <span id="selBase" class="readout">—</span></div>
        <div class="row"><span class="small">Bonus:</span> <span id="selBonus" class="readout">—</span></div>
      </div>

      <div class="scan-block">
        <h3>Mission Simulation</h3>
        <div class="row">
          <input id="simPayout" type="number" placeholder="Mission payout (aUEC)" />
          <button id="runSim">Simulate</button>
        </div>
        <div class="row small">For each rank: <span class="mono">total = base + bonus_flat + (pct * mission / 100)</span></div>
        <div id="simList" class="list" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

/* ===== Supabase config (same as your suite) ===== */
const SUPABASE_URL  = 'https://fcegavhipeaeihxegsnw.supabase.co'
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZjZWdhdmhpcGVhZWloeGVnc253Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjk3NTcsImV4cCI6MjA3NzcwNTc1N30.i-ZjOlKc89-uA7fqOIvmAMv60-C2_NmKikRI_78Jei8'
const sb = createClient(SUPABASE_URL, SUPABASE_ANON)

/* ===== DOM refs ===== */
const grid   = document.getElementById('grid')
const q      = document.getElementById('q')
const exportBtn = document.getElementById('export')
const countInfo = document.getElementById('countInfo')

const kCount = document.getElementById('kCount')
const kAvg   = document.getElementById('kAvg')

const selCode = document.getElementById('selCode')
const selName = document.getElementById('selName')
const selCat  = document.getElementById('selCat')
const selBase = document.getElementById('selBase')
const selBonus= document.getElementById('selBonus')

const simPayout = document.getElementById('simPayout')
const runSim    = document.getElementById('runSim')
const simList   = document.getElementById('simList')

/* ===== State ===== */
let rows = []       // from v_rank_pay_current
let filtered = []   // after search
let selected = null

/* ===== Helpers ===== */
const esc = (s='') => { const d=document.createElement('div'); d.textContent=s; return d.innerHTML }
const fmt = (n) => (n||n===0) ? Number(n).toLocaleString() : '—'
const bonusText = (r) => {
  const f = r.bonus_per_mission || 0
  const p = r.bonus_pct_of_mission_payout || 0
  return `${fmt(f)} + ${p}%`
}
function setSelected(r){
  selected = r
  selCode.textContent  = r?.rank_code || '—'
  selName.textContent  = r ? `${r.rank_name} (${r.paygrade||''})` : '—'
  selCat.textContent   = r?.rank_category || '—'
  selBase.textContent  = r ? `${fmt(r.base_monthly)} aUEC` : '—'
  selBonus.textContent = r ? bonusText(r) : '—'
}
function simulate(payout){
  const m = Number(payout||0)
  const arr = filtered.length ? filtered : rows
  if(!arr.length){ simList.innerHTML = '<div class="small">No ranks loaded.</div>'; return }
  simList.innerHTML = arr.map(r=>{
    const flat = Number(r.bonus_per_mission||0)
    const pct  = Number(r.bonus_pct_of_mission_payout||0)
    const add  = flat + (pct * m / 100)
    const total= Number(r.base_monthly||0) + add
    return `<div class="li">
      <div>
        <div class="small" style="color:#c9b06a">${esc(r.rank_name)} <span class="mono">[${esc(r.rank_code)}]</span></div>
        <div class="small">Bonus: <span class="mono">${fmt(flat)} + ${pct}%</span></div>
      </div>
      <div class="mono">${fmt(total)}</div>
    </div>`
  }).join('')
}

/* ===== Render ===== */
function card(r){
  return `<div class="card" data-code="${esc(r.rank_code)}" role="button" title="Inspect">
    <div class="rank-line">
      <div class="rank-name">${esc(r.rank_name)}</div>
      <div class="rank-code">${esc(r.rank_code||'')}</div>
    </div>
    <div class="meta" aria-hidden="true">
      ${r.rank_category?`<span class="badge">${esc(r.rank_category)}</span>`:''}
      ${r.paygrade?`<span class="badge">Paygrade: ${esc(r.paygrade)}</span>`:''}
      ${r.active_to?`<span class="badge">Active to: ${esc(r.active_to)}</span>`:'<span class="badge">Active</span>'}
    </div>
    <div class="values">
      <div class="v"><label>Base Monthly</label><strong class="mono">${fmt(r.base_monthly)}</strong></div>
      <div class="v"><label>Bonus</label><strong class="mono">${bonusText(r)}</strong></div>
    </div>
    <div class="actions">
      <button class="btn-ghost" data-act="select" data-code="${esc(r.rank_code)}">Scan</button>
      <button class="btn-ghost" data-act="quickSim" data-bonus="${(r.bonus_per_mission||0)}" data-pct="${(r.bonus_pct_of_mission_payout||0)}">Quick Sim</button>
    </div>
  </div>`
}

function render(list){
  grid.innerHTML = list.map(card).join('') || `<div class="small">No results. Adjust search.</div>`
  countInfo.textContent = list.length ? `${list.length} ranks` : '—'
  // bind actions
  grid.querySelectorAll('button[data-act="select"]').forEach(b=>{
    b.onclick = () => {
      const code = b.dataset.code
      const r = rows.find(x=>x.rank_code===code)
      setSelected(r)
    }
  })
  grid.querySelectorAll('button[data-act="quickSim"]').forEach(b=>{
    b.onclick = () => {
      const payout = Number(simPayout.value||0)
      if(!payout){ alert('Set a mission payout first'); return }
      simulate(payout)
    }
  })
  // click card to select
  grid.querySelectorAll('.card').forEach(c=>{
    c.onclick = (e)=>{
      if(e.target.closest('button')) return;
      const code = c.dataset.code
      const r = rows.find(x=>x.rank_code===code)
      setSelected(r)
    }
  })
}

/* ===== Load from Supabase ===== */
async function load(){
  // Pull everything needed for UI
  const { data, error } = await sb
    .from('v_rank_pay_current')
    .select('rank_code, rank_name, paygrade, rank_category, base_monthly, bonus_per_mission, bonus_pct_of_mission_payout, notes, active_from, active_to')
    .order('rank_category',{ascending:true})
  if(error){
    grid.innerHTML = `<div class="small">Failed to load paygrades: ${esc(error.message)}</div>`
    return
  }
  rows = data || []
  filtered = rows.slice()
  render(filtered)
  // KPIs
  kCount.textContent = String(rows.length||0)
  const avg = rows.length ? rows.reduce((a,b)=>a+Number(b.base_monthly||0),0)/rows.length : 0
  kAvg.textContent = avg ? Number(avg).toLocaleString() : '—'
  // Pick first by default
  setSelected(rows[0] || null)
}

/* ===== Search ===== */
q.addEventListener('input', ()=>{
  const v = (q.value || '').toLowerCase()
  filtered = rows.filter(r =>
    (r.rank_name||'').toLowerCase().includes(v) ||
    (r.rank_code||'').toLowerCase().includes(v) ||
    (r.rank_category||'').toLowerCase().includes(v) ||
    (r.paygrade||'').toLowerCase().includes(v)
  )
  render(filtered)
})

/* ===== Export ===== */
exportBtn.onclick = ()=>{
  const blob = new Blob([JSON.stringify(rows,null,2)],{type:'application/json'})
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a'); a.href = url; a.download = 'jmbn-paygrades.json'; a.click()
  URL.revokeObjectURL(url)
}

/* ===== Simulate ===== */
runSim.onclick = ()=>{
  simulate(simPayout.value)
}

/* ===== Boot ===== */
await load()
</script>

<!-- highlight current nav -->
<script>
(() => {
  const here = location.pathname.split('/').pop() || 'paygrades-holo.html';
  document.querySelectorAll('.nav-btn').forEach(a=>{
    if(a.getAttribute('href')===here){a.classList.add('active')}
  });
})();
</script>
</body>
</html>