<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JMBN Fleet / Ship Hangar</title>
<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
<style>
:root { --bg:#000; --panel:#0b0b0b; --border:#d6b44c; --card:#141414; --accent:#f2d675; --text:#f7f1d0; --muted:#c9b06a; --good:#73e39b; --warn:#ffd166; --danger:#ff6b6b; }
*{box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:'Play','Segoe UI',Roboto,Helvetica,Arial,sans-serif;margin:0;padding:18px;letter-spacing:.25px;font-size:14px}
h1{font-weight:700;font-size:20px;color:var(--accent);text-shadow:0 0 8px rgba(242,214,117,.3);margin:0 0 12px;border-bottom:1px solid var(--border);padding-bottom:6px}
a.nav{color:var(--accent);text-decoration:none;margin-right:10px}
.wrap{display:grid;grid-template-columns:1fr 320px;gap:14px}
@media(max-width:980px){.wrap{grid-template-columns:1fr}}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:6px;padding:14px;box-shadow:0 0 10px rgba(214,180,76,.25)}
.controls{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:8px;margin:6px 0 10px}
.controls input,.controls select{background:#0a0a0a;border:1px solid var(--border);border-radius:4px;padding:7px;color:var(--text);font-size:13px}
button{padding:6px 10px;border-radius:4px;background:transparent;color:var(--text);border:1px solid var(--border);cursor:pointer;font-size:12px;transition:.2s;font-family:'Play',sans-serif}
button:hover{background:var(--accent);color:#000}
.btn-primary{background:var(--accent);color:#000}
.grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
@media(max-width:1200px){.grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:720px){.grid{grid-template-columns:1fr}}
.card{position:relative;background:var(--card);border:1px solid var(--border);border-radius:6px;padding:12px;display:flex;gap:12px}
.shipHead{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.shipName{font-weight:700;color:var(--accent);font-size:16px}
.badge{border:1px solid var(--border);border-radius:999px;padding:2px 8px;font-size:11px;color:var(--muted)}
.specs{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:6px;margin:6px 0}
.spec{background:#0a0a0a;border:1px solid var(--border);border-radius:4px;padding:6px;text-align:center}
.spec .k{display:block;color:var(--muted);font-size:10px;text-transform:uppercase;letter-spacing:.5px}
.spec .v{font-weight:700}
.proscons{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.proscons ul{margin:4px 0 0 16px;padding:0}
.small{font-size:11px;color:var(--muted)}
.rightSticky{position:sticky;top:16px;height:fit-content;align-self:start}
label{display:flex;flex-direction:column;gap:4px;margin-bottom:8px;color:var(--muted);font-size:13px}
input,select,textarea{background:#0a0a0a;border:1px solid var(--border);border-radius:4px;padding:7px;color:var(--text);font-size:13px}
textarea{min-height:64px;resize:vertical}
hr{border:none;border-top:1px solid var(--border);opacity:.6;margin:10px 0}

/* Recommended ribbon */
.ribbon{
  position:absolute; top:10px; left:-8px;
  background:linear-gradient(90deg, rgba(242,214,117,0.95), rgba(242,214,117,0.75));
  color:#000; font-weight:700; font-size:11px; padding:4px 10px 4px 16px;
  border-top-right-radius:12px; border-bottom-right-radius:12px; box-shadow:0 0 8px rgba(214,180,76,.35)
}
.ribbon[data-type="solo"]{ background:linear-gradient(90deg,var(--good),#baffc9); }
.ribbon[data-type="budget"]{ background:linear-gradient(90deg,var(--warn),#ffe9a8); }
.ribbon[data-type="heavy"]{ background:linear-gradient(90deg,#f2d675,#ebc24a); }

/* Compare bar & modal */
.compareBar{
  position:sticky; bottom:10px; z-index:5;
  display:flex; gap:8px; align-items:center; justify-content:space-between;
  background:#0a0a0a; border:1px solid var(--border); border-radius:8px;
  padding:8px 10px; box-shadow:0 0 12px rgba(214,180,76,.25)
}
.compareSel{display:flex; gap:6px; flex-wrap:wrap}
.selTag{border:1px solid var(--border); border-radius:999px; padding:2px 8px; font-size:11px}
.modalBack{
  position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:50
}
.modal{
  width:min(960px,94vw); background:#0b0b0b; border:1px solid var(--border); border-radius:10px; padding:14px;
  box-shadow:0 0 18px rgba(214,180,76,.3)
}
.modal h3{margin:0 0 10px; color:var(--accent)}
.modal table{width:100%; border-collapse:collapse; font-size:13px}
.modal th,.modal td{border-bottom:1px solid rgba(214,180,76,.3); padding:8px; text-align:left; vertical-align:top}
.modal .close{float:right}
.checkWrap{display:flex; align-items:center; gap:6px}
</style>
</head>
<body>
    </div>
  <h1>JMBN Fleet / Ship Hangar</h1>
  <div class="small" style="margin-bottom:8px">
    <a class="nav" href="index.html">← Back to Manifest</a>
    <span class="small">All data here is editable and saved locally (browser-only). Use Export/Import to move it.</span>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="controls">
        <input id="q" placeholder="Search ship or role… (e.g., Taurus, Heavy Haul)">
        <select id="role">
          <option value="">All roles</option>
          <option>Heavy Haul</option>
          <option>Medium Haul</option>
          <option>Solo/Starter</option>
          <option>Specialty</option>
        </select>
        <select id="tractor">
          <option value="">Tractor beam: Any</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
          <option value="Planned/Check">Planned/Check</option>
        </select>
        <select id="reco">
          <option value="">Recommendations: Any</option>
          <option value="solo">Best Solo</option>
          <option value="budget">Best Budget</option>
          <option value="heavy">Best Heavy</option>
        </select>
        <select id="sort">
          <option value="-scu">SCU (high → low)</option>
          <option value="scu">SCU (low → high)</option>
          <option value="-crew">Crew (high → low)</option>
          <option value="crew">Crew (low → high)</option>
          <option value="name">Name (A→Z)</option>
        </select>
      </div>

      <div class="grid" id="grid"></div>

      <!-- Compare bar -->
      <div class="compareBar" id="cmpBar" style="display:none; margin-top:12px">
        <div class="compareSel" id="cmpSel"></div>
        <div style="display:flex; gap:6px">
          <button id="btnCompare" class="btn-primary" disabled>Compare (0)</button>
          <button id="btnClearSel">Clear</button>
        </div>
      </div>
    </div>

    <div class="panel rightSticky">
      <h3 style="margin:0 0 8px;color:var(--accent)">Add / Edit Ship</h3>
      <form id="form" autocomplete="off">
        <input type="hidden" id="sid">
        <label>Ship Name<input id="name" required></label>
        <label>Role
          <select id="srole">
            <option value="">-- select --</option>
            <option>Heavy Haul</option>
            <option>Medium Haul</option>
            <option>Solo/Starter</option>
            <option>Specialty</option>
          </select>
        </label>
        <label>SCU Capacity<input id="scu" type="number" step="1" placeholder="e.g., 696"></label>
        <label>Crew (min–opt)<input id="crew" placeholder="e.g., 1–2 or 2–4"></label>
        <label>Tractor Beam
          <select id="stractor">
            <option value="">-- select --</option>
            <option>Yes</option>
            <option>No</option>
            <option>Planned/Check</option>
          </select>
        </label>
        <label>Recommendation (optional)
          <select id="sreco">
            <option value="">— none —</option>
            <option value="solo">Best Solo</option>
            <option value="budget">Best Budget</option>
            <option value="heavy">Best Heavy</option>
          </select>
        </label>
        <label>Pros (one per line)<textarea id="pros"></textarea></label>
        <label>Cons (one per line)<textarea id="cons"></textarea></label>
        <div style="display:flex;gap:6px;margin-top:8px">
          <button type="button" id="save">Save Ship</button>
          <button type="reset" id="reset">Reset</button>
        </div>
      </form>
      <hr>
      <div style="display:flex;gap:6px;flex-wrap:wrap">
        <button id="export">Export JSON</button>
        <button id="import">Import JSON</button>
        <button id="clear">Clear All</button>
        <input type="file" id="file" accept="application/json" style="display:none">
      </div>
      <p class="small" style="margin-top:8px">
        ⚠️ Specs shift by patch. Use “Planned/Check” if unsure; update when verified in-game.
      </p>
    </div>
  </div>

  <!-- Compare modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true" aria-label="Compare Ships">
    <div class="modal">
      <button class="close" id="closeModal">Close ✕</button>
      <h3>Compare Ships</h3>
      <div id="cmpTableWrap"></div>
    </div>
  </div>

<script>
const STORE = 'jmbn-fleet';
const $ = s => document.querySelector(s);
const grid = $('#grid');
let ships = JSON.parse(localStorage.getItem(STORE) || 'null') || seed();

function seed(){
  const arr = [
    {
      id:'C2', name:'Crusader C2 Hercules', role:'Heavy Haul', scu:696, crew:'1–2', tractor:'No',
      pros:['Top-tier SCU for price','Wide ramp, easy loading','Great for legal/contract hauling'],
      cons:['No tractor beam on ship','Big target; needs escort','Longer landing/taxi times'],
      reco:'heavy'
    },
    {
      id:'CAT', name:'Drake Caterpillar', role:'Heavy Haul', scu:576, crew:'1–2', tractor:'Planned/Check',
      pros:['Segmented cargo bays','Good visibility','Flexible mission use'],
      cons:['Long frame; awkward pads','Light defenses','Handling can feel sluggish when loaded']
    },
    {
      id:'TAU', name:'RSI Constellation Taurus', role:'Medium Haul', scu:174, crew:'1–3', tractor:'Planned/Check',
      pros:['Great mid hauler','Decent firepower','Good for box + pallet mix'],
      cons:['Needs longer pads','Less nimble than Cutlass/Freelancer','Check tractor status per patch'],
      reco:'budget'
    },
    {
      id:'FMAX', name:'MISC Freelancer MAX', role:'Medium Haul', scu:122, crew:'1–2', tractor:'No',
      pros:['Solo-friendly','Compact footprint','Good QT range'],
      cons:['Narrow ramp angle','Limited interior space','No ship tractor (often)']
    },
    {
      id:'CUTB', name:'Drake Cutlass Black', role:'Solo/Starter', scu:46, crew:'1–2', tractor:'Planned/Check',
      pros:['All-rounder for contracts','Fast on/off-loading','Good availability'],
      cons:['Lower SCU','Light armor','Tweaked frequently across patches'],
      reco:'solo'
    },
    {
      id:'NOM', name:'CNOU Nomad', role:'Solo/Starter', scu:24, crew:'1', tractor:'No',
      pros:['Great entry hauler','Open-bed = fast loading','Lands almost anywhere'],
      cons:['Exposed cargo bed','Lower total SCU','Best for short, safe hops']
    },
    {
      id:'SRV', name:'Argo SRV', role:'Specialty', scu:0, crew:'1', tractor:'Yes',
      pros:['Dedicated tractor tug','Great for rescue/recovery','Pairs well with bigger haulers'],
      cons:['Not a cargo hauler','Niche role','Team-dependent profits']
    }
  ];
  localStorage.setItem(STORE, JSON.stringify(arr));
  return arr;
}

function li(list){ return (list||[]).map(t=>`<li>${escapeHtml(t)}</li>`).join(''); }
function escapeHtml(s=''){ return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m])); }

function render(){
  const q = ($('#q')?.value||'').toLowerCase();
  const role = $('#role')?.value||'';
  const tractor = $('#tractor')?.value||'';
  const reco = $('#reco')?.value||'';
  const sort = $('#sort')?.value||'-scu';

  let arr = ships.slice();

  if(q) arr = arr.filter(s => `${s.name} ${s.role}`.toLowerCase().includes(q));
  if(role) arr = arr.filter(s => s.role===role);
  if(tractor) arr = arr.filter(s => (s.tractor||'')===tractor);
  if(reco) arr = arr.filter(s => (s.reco||'')===reco);

  switch(sort){
    case 'name': arr.sort((a,b)=>a.name.localeCompare(b.name)); break;
    case 'scu': arr.sort((a,b)=>(+a.scu||0)-(+b.scu||0)); break;
    case '-scu': arr.sort((a,b)=>(+b.scu||0)-(+a.scu||0)); break;
    case 'crew': arr.sort((a,b)=> (parseInt(a.crew)||0) - (parseInt(b.crew)||0)); break;
    case '-crew': arr.sort((a,b)=> (parseInt(b.crew)||0) - (parseInt(a.crew)||0)); break;
  }

  grid.innerHTML = '';
  for(const s of arr){
    const el = document.createElement('div');
    el.className = 'card';
    const checked = selected.has(s.id) ? 'checked' : '';
    el.innerHTML = `
      ${s.reco ? `<div class="ribbon" data-type="${s.reco}">${recLabel(s.reco)}</div>`:``}
      <div style="flex:1">
        <div class="shipHead">
          <div class="shipName">${escapeHtml(s.name)}</div>
          <span class="badge">${escapeHtml(s.role||'—')}</span>
        </div>

        <div class="specs">
          <div class="spec"><span class="k">SCU</span><span class="v">${s.scu ?? '—'}</span></div>
          <div class="spec"><span class="k">Crew</span><span class="v">${escapeHtml(s.crew||'—')}</span></div>
          <div class="spec"><span class="k">Tractor</span><span class="v">${escapeHtml(s.tractor||'—')}</span></div>
          <div class="spec"><span class="k">ID</span><span class="v">${escapeHtml(s.id||'—')}</span></div>
        </div>

        <div class="proscons">
          <div>
            <div class="small" style="color:var(--muted);font-weight:700">Pros</div>
            <ul>${li(s.pros)}</ul>
          </div>
          <div>
            <div class="small" style="color:var(--muted);font-weight:700">Cons</div>
            <ul>${li(s.cons)}</ul>
          </div>
        </div>

        <div style="margin-top:8px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <div class="checkWrap">
            <input type="checkbox" data-id="${s.id}" class="cmpCheck" ${checked}>
            <label class="small" style="margin:0">Compare</label>
          </div>
          <button data-act="edit" data-id="${s.id}">Edit</button>
          <button data-act="del" data-id="${s.id}">Delete</button>
        </div>
      </div>`;
    grid.appendChild(el);
  }
  wireCompareChecks();
}

function recLabel(key){
  return key==='solo'?'Best Solo': key==='budget'?'Best Budget': key==='heavy'?'Best Heavy': 'Recommended';
}

function uid(){ return 'S'+Math.random().toString(36).slice(2,8); }

// ----- Form handlers -----
$('#save').onclick = () => {
  const sh = {
    id: $('#sid').value || uid(),
    name: $('#name').value.trim(),
    role: $('#srole').value,
    scu: +$('#scu').value || 0,
    crew: $('#crew').value.trim(),
    tractor: $('#stractor').value || '',
    reco: $('#sreco').value || '',
    pros: ($('#pros').value||'').split('\n').map(s=>s.trim()).filter(Boolean),
    cons: ($('#cons').value||'').split('\n').map(s=>s.trim()).filter(Boolean)
  };
  if(!sh.name){ alert('Ship name required'); return; }
  const i = ships.findIndex(x=>x.id===sh.id);
  if(i>=0) ships[i]=sh; else ships.push(sh);
  localStorage.setItem(STORE, JSON.stringify(ships));
  document.getElementById('form').reset();
  $('#sid').value='';
  render();
};

$('#reset').onclick = () => { $('#sid').value=''; };

grid.addEventListener('click', (e)=>{
  const btn = e.target.closest('button'); if(!btn) return;
  const id = btn.dataset.id; const act = btn.dataset.act;
  const s = ships.find(x=>x.id===id); if(!s) return;

  if(act==='edit'){
    $('#sid').value = s.id;
    $('#name').value = s.name||'';
    $('#srole').value = s.role||'';
    $('#scu').value = s.scu||'';
    $('#crew').value = s.crew||'';
    $('#stractor').value = s.tractor||'';
    $('#sreco').value = s.reco||'';
    $('#pros').value = (s.pros||[]).join('\n');
    $('#cons').value = (s.cons||[]).join('\n');
    window.scrollTo({top:0,behavior:'smooth'});
  }
  if(act==='del'){
    if(confirm('Delete this ship?')){
      ships = ships.filter(x=>x.id!==id);
      localStorage.setItem(STORE, JSON.stringify(ships));
      selected.delete(id);
      render();
      updateCompareBar();
    }
  }
});

// ----- Filters & sort -----
['q','role','tractor','reco','sort'].forEach(id => {
  const el = document.getElementById(id);
  el && el.addEventListener('input', render);
  el && el.addEventListener('change', render);
});

// ----- Export / Import / Clear -----
function download(filename, text){
  const blob = new Blob([text], { type:'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename;
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}
document.getElementById('export').onclick = () => {
  const ts = new Date().toISOString().replace(/[:.]/g,'-');
  download(`jmbn-fleet-${ts}.json`, JSON.stringify(ships,null,2));
};
document.getElementById('import').onclick = () => document.getElementById('file').click();
document.getElementById('file').addEventListener('change', e => {
  const f = e.target.files?.[0]; if(!f) return;
  const r = new FileReader();
  r.onload = () => {
    try{
      const data = JSON.parse(r.result);
      if(!Array.isArray(data)) throw new Error('Invalid JSON (expected an array).');
      const merge = confirm('Merge with existing fleet? Click "Cancel" to REPLACE.');
      ships = merge ? mergeById(ships, data) : data;
      localStorage.setItem(STORE, JSON.stringify(ships));
      render(); alert('Import complete.');
    }catch(err){ alert('Import failed: '+err.message); }
    e.target.value='';
  };
  r.readAsText(f);
});
function mergeById(a,b){
  const map = new Map(a.map(x=>[x.id||uid(), x]));
  for(const x of b){ map.set(x.id||uid(), x); }
  return Array.from(map.values());
}
document.getElementById('clear').onclick = () => {
  if(!confirm('Delete ALL ships from local storage?')) return;
  ships = []; localStorage.setItem(STORE, JSON.stringify(ships)); selected.clear(); render(); updateCompareBar();
};

// ----- Compare selection & modal -----
const selected = new Set();
function wireCompareChecks(){
  document.querySelectorAll('.cmpCheck').forEach(chk=>{
    chk.addEventListener('change', (e)=>{
      const id = e.target.dataset.id;
      if(e.target.checked){
        if(selected.size>=3){
          e.target.checked=false;
          alert('You can compare up to 3 ships.');
          return;
        }
        selected.add(id);
      }else{
        selected.delete(id);
      }
      updateCompareBar();
    });
  });
  updateCompareBar();
}

function updateCompareBar(){
  const bar = $('#cmpBar');
  const sel = $('#cmpSel');
  if(selected.size===0){ bar.style.display='none'; sel.innerHTML=''; $('#btnCompare').disabled=true; $('#btnCompare').textContent='Compare (0)'; return; }
  bar.style.display='flex';
  sel.innerHTML = [...selected].map(id=>{
    const s = ships.find(x=>x.id===id);
    return `<span class="selTag">${escapeHtml(s?.name||id)}</span>`;
  }).join('');
  $('#btnCompare').disabled = selected.size<2;
  $('#btnCompare').textContent = `Compare (${selected.size})`;
}
$('#btnClearSel').onclick = () => { selected.clear(); render(); updateCompareBar(); };

$('#btnCompare').onclick = () => {
  const list = [...selected].map(id=>ships.find(x=>x.id===id)).filter(Boolean);
  const rows = [
    ['Name', ...list.map(s=>escapeHtml(s.name||''))],
    ['Role', ...list.map(s=>escapeHtml(s.role||''))],
    ['SCU', ...list.map(s=>s.scu ?? '—')],
    ['Crew', ...list.map(s=>escapeHtml(s.crew||''))],
    ['Tractor', ...list.map(s=>escapeHtml(s.tractor||''))],
    ['Recommendation', ...list.map(s=>s.reco ? recLabel(s.reco): '—')],
    ['Pros', ...list.map(s=>`<ul style="margin:0 0 0 18px">${li(s.pros)}</ul>`)],
    ['Cons', ...list.map(s=>`<ul style="margin:0 0 0 18px">${li(s.cons)}</ul>`)]
  ];
  const cols = list.length;
  let html = `<table><thead><tr><th>Spec</th>${'<th>Ship</th>'.repeat(cols)}</tr></thead><tbody>`;
  for(const r of rows){
    html += `<tr><td style="color:var(--muted);font-weight:700">${r[0]}</td>${r.slice(1).map(v=>`<td>${v}</td>`).join('')}</tr>`;
  }
  html += `</tbody></table>`;
  $('#cmpTableWrap').innerHTML = html;
  openModal();
};

function openModal(){ $('#modalBack').style.display='flex'; }
function closeModal(){ $('#modalBack').style.display='none'; }
$('#closeModal').onclick = closeModal;
$('#modalBack').addEventListener('click', (e)=>{ if(e.target.id==='modalBack') closeModal(); });

// Init
render();
</script>
</body>
</html>
