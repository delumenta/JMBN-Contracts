const rel = reqByCert.get(cert.certification_code) || [];
const completed = rel.filter(r=>doneSet.has(r.event_code)).length;
const pct = Math.round((completed / Math.max(1, rel.length)) * 100);
const isOwned = ownedSet.has(cert.certification_code);

const div = document.createElement('div');
div.className = 'badge ' + (isOwned ? 'owned' : 'locked');
div.innerHTML = `
  <div class="hex">
    <div class="medal">
      <img src="${cert.image_url || ''}" alt="${cert.name}">
    </div>
  </div>
  <div class="title">${cert.name}</div>
  <div class="code">${cert.certification_code}</div>

  <div class="reqbox">
    <div class="bar"><div class="fill" style="width:${pct}%"></div></div>
    <ul>
      ${rel.map(r=>{
        const ok = doneSet.has(r.event_code);
        return `<li>
          <span>${r.title}</span>
          <span class="${ok?'ok':'pending'}">${ok?'✔':'—'}</span>
        </li>`;
      }).join('')}
    </ul>
    ${isElevated ? `<div style="margin-top:8px;text-align:right">
      <button class="manage" style="font-size:12px">Manage</button>
    </div>` : ``}
  </div>
`;
if(isElevated){
  div.querySelector('.manage').onclick = () => openModal(cert.certification_code, cert.name);
}
grid.appendChild(div);
