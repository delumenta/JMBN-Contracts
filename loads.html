<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>JMBN Loadouts (Callouts)</title>
<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#000;--panel:#0b0b0b;--border:#d6b44c;--accent:#f2d675;--text:#f7f1d0;--muted:#c9b06a}
*{box-sizing:border-box} body{margin:0;background:#000;color:var(--text);font-family:'Play',system-ui,sans-serif}
.wrap{max-width:1120px;margin:14px auto;padding:0 12px;display:grid;grid-template-columns:minmax(300px,720px) 1fr;gap:12px}
.panel{background:#0b0b0b;border:1px solid var(--border);border-radius:12px;padding:12px}
h1{margin:0 0 8px;color:var(--accent);font-size:22px}
.note{color:var(--muted);font-size:12px}

.gear{position:relative}
svg{display:block;width:100%;height:auto}

/* hotspots */
.hot{fill:rgba(242,214,117,.10);stroke:#d6b44c;stroke-width:2;transition:fill .15s ease,filter .15s ease}
.hot:hover{fill:rgba(242,214,117,.26);filter:drop-shadow(0 0 6px rgba(214,180,76,.6));cursor:pointer}
.lbl{font-size:14px;fill:#f2d675}

/* arrow */
.call{fill:none;stroke:#d6b44c;stroke-width:2.2;marker-end:url(#arrowHead)}
/* guides toggle (if you want to see hit areas clearly) */
.guides .hot{fill:rgba(255,99,71,.18) !important;stroke:#ffdd99 !important}
</style>
</head>
<body>
<div class="wrap">
  <!-- IMAGE + SVG -->
  <div class="panel gear">
    <h1>Loadout Callouts</h1>
    <div class="note">Click Helmet or Armor. Toggle “Guides” if you want to adjust positions.</div>
    <label class="note" style="display:flex;gap:8px;align-items:center;margin-top:6px">
      <input id="guides" type="checkbox"> Show guides
    </label>

    <svg viewBox="0 0 1000 1500" xmlns="http://www.w3.org/2000/svg" id="stage">
      <defs>
        <marker id="arrowHead" markerWidth="9" markerHeight="9" refX="7" refY="4.5" orient="auto">
          <path d="M0,0 L0,9 L9,4.5 z" fill="#d6b44c"/>
        </marker>
      </defs>

      <!-- background image (use your hosted copy if Reddit blocks hotlink) -->
      <image href="https://i.redd.it/21ngs91ahfqa1.jpg"
             x="0" y="0" width="1000" height="1500" preserveAspectRatio="xMidYMid slice"/>

      <!-- ===== HOTSPOTS (only Helmet + Armor are interactive) ===== -->

      <!-- HELMET: nudged slightly up -->
      <g class="hs" data-slot="helmet"
         data-title="Helmet"
         data-buy="Cousin Crows (Orison), Platinum Bay (CRU-L5)"
         data-notes="Good visibility; stable comms."
         data-x="505" data-y="215">
        <circle class="hot" cx="505" cy="215" r="95"></circle>
        <text class="lbl" x="505" y="200" text-anchor="middle">Helmet</text>
      </g>

      <!-- ARMOR (chest): nudged a bit lower/wider -->
      <g class="hs" data-slot="armor"
         data-title="Armor (Chest)"
         data-buy="Cubby Blast (Area18), Omega Pro (New Babbage)"
         data-notes="Balanced protection; easy to source."
         data-x="505" data-y="450">
        <rect class="hot" x="385" y="350" width="240" height="220" rx="18" ry="18"></rect>
        <text class="lbl" x="505" y="338" text-anchor="middle">Armor</text>
      </g>

      <!-- Arrow (source point updates on click, target is card's left edge mid) -->
      <path id="arrow" class="call" d="M505,215 C620,215 730,230 760,230" />
      <!-- Info card lives inside SVG so arrows are easy -->
      <foreignObject id="cardFO" x="760" y="150" width="230" height="220">
        <div xmlns="http://www.w3.org/1999/xhtml"
             style="background:#0c0c0c;border:1px solid #d6b44c;border-radius:12px;padding:12px;color:#f7f1d0;box-shadow:0 0 16px rgba(214,180,76,.18)">
          <div id="cTitle" style="color:#f2d675;font-weight:800;margin-bottom:6px">Helmet</div>
          <div style="font-size:12px;line-height:1.35">
            <div style="margin:6px 0">
              <span style="color:#c9b06a">Where to buy:</span>
              <div id="cBuy" style="margin-top:2px">Cousin Crows (Orison), Platinum Bay (CRU-L5)</div>
            </div>
            <div style="margin:6px 0">
              <span style="color:#c9b06a">Notes:</span>
              <div id="cNotes" style="margin-top:2px">Good visibility; stable comms.</div>
            </div>
          </div>
          <a id="cOpen" href="components.html?slot=helmet"
             style="display:inline-block;margin-top:8px;padding:6px 10px;border:1px solid #d6b44c;border-radius:10px;text-decoration:none;background:linear-gradient(180deg,#f2d675,#e7c760);color:#000;font-weight:700">Open Components</a>
        </div>
      </foreignObject>
    </svg>
  </div>

  <!-- QUICK TEXT EDIT (optional) -->
  <div class="panel">
    <h1>Quick Edit</h1>
    <div class="note">Update what to buy / where to buy for the selected part.</div>
    <div style="display:grid;gap:8px;margin-top:10px">
      <label>Title <input id="fTitle" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;background:#0a0a0a;color:var(--text)"></label>
      <label>Where to buy <input id="fBuy" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;background:#0a0a0a;color:var(--text)"></label>
      <label>Notes <textarea id="fNotes" rows="4" style="width:100%;padding:8px;border:1px solid var(--border);border-radius:8px;background:#0a0a0a;color:var(--text)"></textarea></label>
      <button id="apply" style="padding:10px;border:1px solid var(--border);border-radius:10px;background:linear-gradient(180deg,#0c0c0c,#060606);color:var(--accent);cursor:pointer">Apply to Card</button>
    </div>
  </div>
</div>

<script>
const stage = document.getElementById('stage');
const arrow = document.getElementById('arrow');
const cardFO = document.getElementById('cardFO');
const card = {
  title: document.getElementById('cTitle'),
  buy:   document.getElementById('cBuy'),
  notes: document.getElementById('cNotes'),
  link:  document.getElementById('cOpen')
};
const fTitle = document.getElementById('fTitle');
const fBuy   = document.getElementById('fBuy');
const fNotes = document.getElementById('fNotes');
let current = null; // currently selected hotspot <g>

function redrawArrow(sx, sy){
  const x = parseFloat(cardFO.getAttribute('x')), y = parseFloat(cardFO.getAttribute('y')), h = parseFloat(cardFO.getAttribute('height'));
  const tx = x, ty = y + h/2;
  const c1x = sx + Math.min(120, Math.abs(tx - sx) * 0.4);
  const c1y = sy, c2x = tx - 60, c2y = ty;
  arrow.setAttribute('d', `M${sx},${sy} C${c1x},${c1y} ${c2x},${c2y} ${tx},${ty}`);
}

// bind only helmet + armor
stage.querySelectorAll('.hs').forEach(g=>{
  g.addEventListener('click', ()=>{
    current = g;
    const sx = Number(g.dataset.x), sy = Number(g.dataset.y);
    const slot = g.dataset.slot || 'part';
    const title = g.dataset.title || slot;
    const buy = g.dataset.buy || '—';
    const notes = g.dataset.notes || '—';

    // update card
    card.title.textContent = title;
    card.buy.textContent = buy;
    card.notes.textContent = notes;
    card.link.href = `components.html?slot=${encodeURIComponent(slot)}`;

    // mirror into right-hand quick edit fields (optional)
    fTitle.value = title; fBuy.value = buy; fNotes.value = notes;

    redrawArrow(sx, sy);
  });
});

// set initial state to helmet
stage.querySelector('.hs[data-slot="helmet"]').dispatchEvent(new Event('click'));

// apply edits back to card and hotspot dataset
document.getElementById('apply').addEventListener('click', ()=>{
  if(!current) return;
  current.dataset.title = card.title.textContent = fTitle.value.trim() || current.dataset.title;
  current.dataset.buy   = card.buy.textContent   = fBuy.value.trim()   || current.dataset.buy;
  current.dataset.notes = card.notes.textContent = fNotes.value.trim() || current.dataset.notes;
});

// guides toggle
document.getElementById('guides').addEventListener('change', e=>{
  stage.classList.toggle('guides', e.target.checked);
});
</script>
</body>
</html>
