<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>JMBN – Admin Console</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png"
      href="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png">

<style>
:root{
  --bg:#000;--panel:#0b0b0b;--sub:#0f0f0f;--row:#0a0a0a;
  --border:#d6b44c;--card:#141414;
  --accent:#f2d675;--text:#f7f1d0;--muted:#c9b06a;--bad:#ff6b6b;--ok:#5cd47c;
  --fs-base:14px;--fs-small:11px;--fs-h1:clamp(18px,2.2vw,22px);
}
*{box-sizing:border-box}
body{
  margin:0;padding:14px;
  background:
    radial-gradient(1200px 900px at 15% -10%, rgba(242,214,117,.08), transparent 60%),
    radial-gradient(900px 700px at 120% 110%, rgba(214,180,76,.05), transparent 60%),
    #000;
  color:var(--text);
  font-family:'Play',system-ui,sans-serif;
  font-size:var(--fs-base);
  letter-spacing:.25px;
}

/* Brand fallback (in case header2.html fails) */
.brand{
  display:flex;align-items:center;gap:10px;
  margin:0 0 8px;padding-bottom:6px;
  border-bottom:1px solid var(--border);
}
.brand-logo{
  width:44px;height:44px;object-fit:contain;
  filter:drop-shadow(0 0 4px rgba(242,214,117,.25));
}
.brand h1{
  margin:0;font-size:var(--fs-h1);font-weight:700;color:var(--accent);
}

/* Layout */
.page{max-width:1200px;margin:0 auto;}
.grid{
  display:grid;
  grid-template-columns:minmax(320px,0.9fr) minmax(420px,1.1fr);
  gap:14px;
}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

/* Panels */
.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
  box-shadow:0 0 18px rgba(214,180,76,.22),inset 0 0 0 1px rgba(214,180,76,.12);
}
.panel .hd{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
}
.panel .hd h3{
  margin:0;color:var(--accent);font-size:16px;font-weight:700;
  display:flex;align-items:center;gap:10px;
}
.panel .body{padding:10px 12px 12px}

/* Tags / pills / text */
.badge{
  display:inline-block;
  border:1px solid var(--border);
  border-radius:999px;
  padding:2px 7px;
  font-size:10px;
  color:var(--muted);
  background:#050505;
}
.pill{
  display:inline-block;
  border-radius:999px;
  border:1px solid var(--border);
  padding:4px 10px;
  font-size:12px;
  background:#050505;
  color:var(--accent);
}
.small{font-size:var(--fs-small);color:var(--muted)}

/* Inputs / buttons */
input[type="search"],select{
  width:100%;
  background:#0a0a0a;
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px 10px;
  color:var(--text);
  font-family:'Play';
  font-size:var(--fs-base);
}
button{
  padding:8px 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:linear-gradient(180deg,#0c0c0c,#060606);
  color:var(--accent);
  cursor:pointer;
  font-family:'Play';
  font-size:12px;
  font-weight:700;
  transition:.18s;
}
button:hover{
  background:var(--accent);
  color:#000;
  box-shadow:0 0 12px rgba(214,180,76,.35);
}
.btn-danger{border-color:var(--bad);color:var(--bad)}
.btn-ok{border-color:var(--ok);color:var(--ok)}
.btn-ghost{
  background:transparent;
  border-radius:999px;
}

/* Member list */
.mlist{
  display:flex;
  flex-direction:column;
  gap:8px;
  max-height:70vh;
  overflow:auto;
}
.mrow{
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:10px;
  align-items:center;
  padding:8px;
  border-radius:10px;
  border:1px solid transparent;
  background:#0a0a0a;
  cursor:pointer;
  box-shadow:inset 0 0 0 1px rgba(214,180,76,.08);
}
.mrow:hover{
  background:#111;
  border-color:rgba(214,180,76,.45);
}
.mrow.active{
  background:rgba(214,180,76,.16);
  border-color:var(--border);
}

/* Avatar – frameless, no gold border */
.mavatar{
  width:38px;height:38px;
  display:grid;place-items:center;
  overflow:hidden;
  background:transparent;
  border:none;
}
.mavatar img{
  width:100%;height:100%;object-fit:contain;
  border:none;background:transparent;box-shadow:none;filter:none;
}

/* KPI cards */
.kpis{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin:10px 0;
}
@media(max-width:720px){.kpis{grid-template-columns:1fr 1fr}}
@media(max-width:520px){.kpis{grid-template-columns:1fr}}
.kpi{
  background:linear-gradient(180deg,#0b0b0b,#080808);
  border-radius:10px;
  border:1px solid var(--border);
  padding:8px;
  box-shadow:0 0 14px rgba(214,180,76,.18),inset 0 0 0 1px rgba(214,180,76,.12);
  text-align:center;
}
.kpi h4{
  margin:0 0 4px;
  font-size:11px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:.08em;
}
.kpi .val{
  font-size:18px;
  font-weight:700;
  color:var(--accent);
}

/* Progress bars */
.pb{
  display:grid;
  grid-template-columns:120px 1fr auto;
  gap:10px;
  align-items:center;
  margin:6px 0;
}
.pb .label{color:var(--muted);font-size:12px}
.bar{
  height:12px;background:#0a0a0a;
  border-radius:999px;border:1px solid var(--border);
  overflow:hidden;
}
.fill{
  height:100%;
  background:linear-gradient(180deg,var(--accent),#d6b44c);
}
.pb .val{
  font-variant-numeric:tabular-nums;
  color:var(--muted);
  font-size:12px;
}

/* Cert grid – 6-up, logo + abbrev only */
.certGrid{
  display:grid;
  grid-template-columns:repeat(6,minmax(0,1fr));
  gap:10px;
}
@media(max-width:1100px){.certGrid{grid-template-columns:repeat(4,minmax(0,1fr))}}
@media(max-width:780px){ .certGrid{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media(max-width:520px){ .certGrid{grid-template-columns:repeat(2,minmax(0,1fr))}}

.cert{
  background:transparent;
  border:none;
  padding:6px;
  text-align:center;
}
.cert.dim{opacity:.5;filter:grayscale(.5)}
.cert .thumb{
  height:72px;
  display:grid;place-items:center;
  margin-bottom:4px;
}
.cert .thumb img{
  max-height:60px;max-width:60px;
  width:auto;height:auto;object-fit:contain;
}
.cert .abbr{
  font-weight:700;
  letter-spacing:.5px;
  color:var(--accent);
  font-size:12px;
}
.cert .title,.cert .small,.cert .meta,[data-open]{display:none!important}

/* Timeline (no dots) */
.timeline{
  position:relative;
  margin-top:10px;
  padding-left:0;
}
.timeline::before{
  content:"";
  position:absolute;
  left:0;top:0;bottom:0;
  width:2px;
  background:linear-gradient(var(--border),transparent);
}
.titem{
  position:relative;
  padding:10px 8px;
  border-bottom:1px solid rgba(255,255,255,.06);
  display:grid;
  grid-template-columns:1fr auto;
  gap:10px;
}
.titem.done .tlabel{color:var(--accent)}
.tdot{display:none!important}

/* Missions list */
.list{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.item{
  border:1px solid var(--border);
  border-radius:10px;
  background:#0b0b0b;
  padding:10px;
  box-shadow:0 0 10px rgba(214,180,76,.18),inset 0 0 0 1px rgba(214,180,76,.08);
}
.item h4{margin:0 0 4px;color:var(--accent);font-size:14px}
.item .meta{font-size:12px;color:var(--muted)}
</style>
</head>
<body>

<!-- Shared header mount (header2.html) -->
<div id="header2-mount">
  <!-- Fallback if header2.html fails -->
  <div class="brand">
    <img class="brand-logo"
         src="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png"
         alt="JMBN">
    <h1>JMBN Admin Console</h1>
  </div>
</div>

<div class="page">
  <div class="grid">

    <!-- LEFT: Members list -->
    <section class="panel">
      <div class="hd">
        <h3>Members</h3>
      </div>
      <div class="body">
        <input id="mSearch" type="search" placeholder="Search handle / name…">
        <div id="mList" class="mlist" style="margin-top:8px">Loading…</div>
      </div>
    </section>

    <!-- RIGHT: Inspector / dashboard -->
    <section class="panel">
      <div class="hd">
        <h3>Member Dashboard</h3>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <select id="rankTrack" title="Rank Track">
            <option value="">— Track —</option>
            <option value="Officer">Officer</option>
            <option value="Enlisted">Enlisted</option>
            <option value="Warrant">Warrant</option>
          </select>
          <button id="btnForce" class="pill" title="Force set user's rank track">Force Track</button>

          <select id="rankCode" title="Rank Code">
            <option value="">— Select Rank —</option>
          </select>
          <button id="btnSetRank" class="pill" title="Force set a specific rank code">Set Rank</button>

          <button id="btnPromote" class="pill" disabled>Run Promotion Check</button>
        </div>
      </div>

      <div class="body" id="inspector">
        <div class="small">Select a member to view their dashboard &amp; activity.</div>
      </div>
    </section>

  </div>
</div>

<!-- Supabase + auth -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="js/auth.js"></script>

<!-- Mount shared header2.html & highlight nav -->
<script>
async function mountHeader2(){
  const mount = document.getElementById('header2-mount');
  if(!mount) return;
  try{
    const res = await fetch('header2.html',{cache:'no-cache'});
    if(!res.ok) return;
    const html = await res.text();
    mount.innerHTML = html;

    // highlight this page in header nav if matching link exists
    const here = (location.pathname.split('/').pop() || 'index.html');
    const active = mount.querySelector(`.nav-btn[href="${here}"]`);
    if(active) active.classList.add('active');
  }catch(err){
    console.error('Failed to mount header2:', err);
  }
}
mountHeader2();
</script>

<script>
const $  = s => document.querySelector(s);
const esc = s => { const d=document.createElement('div'); d.textContent=s??''; return d.innerHTML; };
const setFill=(
