<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JMBN – Hangar Components Storage</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #000;
      --panel: #0d0d0d;
      --shelf: #131313;
      --shelf-edge: #1f1a09;
      --gold: #d6b44c;
      --gold-soft: rgba(214,180,76,0.6);
      --gold-faint: rgba(214,180,76,0.22);
      --text: #f7f1d0;
      --muted: #c9b06a;
      --fs-sm: 12px;
      --fs-base: 14px;
      --fs-lg: 18px;
      --radius: 12px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      height: 100%;
      background: radial-gradient(circle at top, #1b160a 0, #000 65%);
      color: var(--text);
      font-family: "Play", sans-serif;
      overflow: hidden;
    }

    /* Layout */
    #layout {
      display: grid;
      grid-template-columns: 72% 28%;
      height: calc(100vh - 10px);
      padding: 10px;
    }

    /* LEFT SIDE – Shelves */
    #shelves {
      overflow-y: auto;
      padding-right: 10px;
    }

    .shelf {
      background: var(--shelf);
      border: 1px solid var(--gold-faint);
      border-left: 5px solid var(--gold);
      padding: 10px 12px;
      border-radius: var(--radius);
      margin-bottom: 14px;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.6);
    }

    .shelf-title {
      font-size: var(--fs-lg);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 6px;
      color: var(--gold);
    }

    .shelf-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
    }

    /* Component Box */
    .component-box {
      background: linear-gradient(160deg,#0f0f0f,#1a1409);
      border: 1px solid var(--gold-faint);
      padding: 10px;
      border-radius: var(--radius);
      cursor: pointer;
      transition: transform .15s, box-shadow .15s, border-color .15s;
      position: relative;
    }
    .component-box:hover {
      transform: translateY(-3px);
      border-color: var(--gold-soft);
      box-shadow: 0 0 12px rgba(214,180,76,0.5);
    }

    .component-name {
      color: var(--gold);
      font-size: var(--fs-base);
      font-weight: 700;
      margin-bottom: 4px;
    }

    .component-meta {
      font-size: var(--fs-sm);
      color: var(--muted);
    }

    /* Drawer */
    .drawer {
      position: fixed;
      right: -420px;
      top: 0;
      width: 400px;
      height: 100%;
      background: var(--panel);
      border-left: 2px solid var(--gold);
      box-shadow: -6px 0 20px rgba(0,0,0,0.6);
      padding: 20px;
      transition: right .3s ease;
      overflow-y: auto;
      z-index: 999;
    }
    .drawer.open {
      right: 0;
    }

    .drawer-title {
      font-size: var(--fs-lg);
      color: var(--gold);
      margin-bottom: 8px;
    }

    .drawer-line {
      font-size: var(--fs-base);
      margin-bottom: 5px;
    }

    /* Shopping list */
    #right-panel {
      background: var(--panel);
      border-left: 1px solid var(--gold-faint);
      padding: 12px;
      overflow-y: auto;
    }

    #shopping-title {
      font-size: var(--fs-lg);
      color: var(--gold);
      text-align: center;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: .1em;
    }

    #shopping-items {
      min-height: 50px;
      border: 1px solid var(--gold-faint);
      padding: 8px;
      border-radius: var(--radius);
      background: rgba(20,20,20,0.9);
      margin-bottom: 12px;
      font-size: var(--fs-sm);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      background: rgba(214,180,76,0.18);
      border: 1px solid var(--gold-soft);
      padding: 3px 7px;
      border-radius: 999px;
      margin: 2px;
      font-size: 11px;
      color: var(--gold);
    }

    .tag-remove {
      margin-left: 4px;
      cursor: pointer;
      color: var(--muted);
    }

    #route-btn {
      width: 100%;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid var(--gold);
      background: rgba(214,180,76,0.18);
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: .1em;
      cursor: pointer;
      transition: .2s;
    }
    #route-btn:hover {
      background: rgba(214,180,76,0.35);
      box-shadow: 0 0 12px rgba(214,180,76,0.5);
    }

    #route-output {
      border: 1px solid var(--gold-faint);
      border-radius: var(--radius);
      padding: 10px;
      background: rgba(30,25,20,0.9);
      font-size: var(--fs-sm);
      margin-top: 10px;
    }

  </style>
</head>

<body>

<div id="layout">

  <!-- LEFT SHELVES -->
  <div id="shelves"></div>

  <!-- RIGHT SHOPPING PANEL -->
  <div id="right-panel">
    <div id="shopping-title">Shopping List</div>

    <div id="shopping-items">No components selected.</div>

    <button id="route-btn">Generate Route</button>

    <div id="route-output"></div>
  </div>

</div>

<!-- Drawer -->
<div id="drawer" class="drawer"></div>

<script>
const DATA_COMPONENTS = "data/components.js";

let allComponents = [];
let selectedItems = new Set();

/* Load Data */
fetch(DATA_COMPONENTS)
  .then(r => r.json())
  .then(data => {
    allComponents = data;
    buildShelves(data);
  });

/* Group by Component Type */
function buildShelves(list) {
  const shelves = {};

  list.forEach(c => {
    if (!shelves[c.Component]) shelves[c.Component] = [];
    shelves[c.Component].push(c);
  });

  const shelvesDiv = document.getElementById("shelves");
  shelvesDiv.innerHTML = "";

  for (const [type, items] of Object.entries(shelves)) {
    const shelf = document.createElement("div");
    shelf.className = "shelf";

    shelf.innerHTML = `
      <div class="shelf-title">${type}</div>
      <div class="shelf-items"></div>
    `;

    const shelfItems = shelf.querySelector(".shelf-items");

    items.forEach(c => {
      const box = document.createElement("div");
      box.className = "component-box";
      box.innerHTML = `
        <div class="component-name">${c.Names}</div>
        <div class="component-meta">S${c.Size} • Grade ${c.Grade} • ${c.Class}</div>
      `;

      box.onclick = () => openDrawer(c);

      shelfItems.appendChild(box);
    });

    shelvesDiv.appendChild(shelf);
  }
}

/* Drawer */
function openDrawer(c) {
  const drawer = document.getElementById("drawer");
  drawer.classList.add("open");

  const shopStr = Array.isArray(c.Shops) ? c.Shops.join(", ") :
                  c.WhereToBuy || "—";

  drawer.innerHTML = `
    <div class="drawer-title">${c.Names}</div>
    <div class="drawer-line"><strong>Component:</strong> ${c.Component}</div>
    <div class="drawer-line"><strong>Size:</strong> ${c.Size}</div>
    <div class="drawer-line"><strong>Grade:</strong> ${c.Grade}</div>
    <div class="drawer-line"><strong>Class:</strong> ${c.Class}</div>
    <div class="drawer-line"><strong>Manufacturer:</strong> ${c.Manufacturer}</div>
    <div class="drawer-line"><strong>Shops:</strong> ${shopStr}</div>

    <button class="add-route-btn" onclick="addToCart('${c.Names.replace(/'/g,"\\'")}')">
      Add to Shopping List
    </button>

    <button class="add-route-btn"
      style="margin-top:10px;background:rgba(180,20,20,0.4)"
      onclick="closeDrawer()">
      Close
    </button>
  `;
}

function closeDrawer() {
  document.getElementById("drawer").classList.remove("open");
}

/* Shopping List */
function addToCart(name) {
  selectedItems.add(name);
  renderShoppingList();
}

function removeFromCart(name) {
  selectedItems.delete(name);
  renderShoppingList();
}

function renderShoppingList() {
  const div = document.getElementById("shopping-items");

  if (selectedItems.size === 0) {
    div.innerHTML = "No components selected.";
    return;
  }

  div.innerHTML = [...selectedItems].map(n =>
    `<span class="tag">${n}
      <span class="tag-remove" onclick="removeFromCart('${n.replace(/'/g,"\\'")}')">✕</span>
    </span>`
  ).join("");
}

/* Route Planner (Simple Version) */
document.getElementById("route-btn").onclick = () => {
  const out = document.getElementById("route-output");

  if (selectedItems.size === 0) {
    out.innerHTML = "No components selected.";
    return;
  }

  out.innerHTML = `
    <strong>Recommended Stops:</strong><br><br>
    1. Area18 / Baijini Point (Most Components)<br>
    2. Lorville (Second Priority)<br>
    3. Port Tressler / New Babbage (if needed)<br>
    4. Avoid Orison unless required<br><br>

    <em>(Advanced route planner available in next build.)</em>
  `;
};
</script>

</body>
</html>
