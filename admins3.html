<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>JMBN – Components HoloTable</title>

<!-- Play Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ============================================================
   JMBN GOLD HYBRID HOLO UI — GLOBAL STYLES
   ============================================================ */
:root {
  --gold: #d6b44c;
  --gold-soft: rgba(214,180,76,0.65);
  --gold-faint: rgba(214,180,76,0.25);

  --blue-holo: #5dd0ff;
  --blue-holo-soft: rgba(93,208,255,0.4);
  --blue-holo-faint: rgba(93,208,255,0.2);

  --bg-main: #000;
  --bg-panel: rgba(5,5,10,0.65);
  --bg-panel-deep: rgba(10,10,18,0.85);

  --text: #f7f1d0;
  --text-soft: rgba(247,241,208,0.75);

  --radius: 14px;
  --blur: 14px;
  --transition: 0.25s ease;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: radial-gradient(circle at 20% 20%, #1a1408 0%, #000 60%);
  font-family: "Play", sans-serif;
  color: var(--text);
  overflow: hidden;
}

/* ============================================================
   PAGE LAYOUT — THREE PANELS
   ============================================================ */
#layout {
  display: grid;
  grid-template-columns: 28% 42% 30%;
  grid-template-rows: 100%;
  height: 100vh;
  width: 100vw;
}

/* ============================================================
   LEFT PANEL — HOLOGRAPHIC MAP
   ============================================================ */
#holo-map-container {
  padding: 12px;
  background: linear-gradient(160deg, rgba(5,8,12,0.6), rgba(2,3,6,0.9));
  border-right: 1px solid var(--gold-soft);
  box-shadow: inset 0 0 24px rgba(214,180,76,0.15);
  position: relative;
  overflow: hidden;
}

#holo-map-title {
  text-align: center;
  letter-spacing: 0.1em;
  color: var(--gold);
  font-size: 1.2rem;
  padding-bottom: 8px;
}

/* holographic map */
#holo-map {
  width: 100%;
  height: 88%;
  filter: drop-shadow(0 0 14px var(--blue-holo-soft));
  position: relative;
}

.holo-node {
  fill: var(--blue-holo);
  stroke: var(--gold);
  stroke-width: 1px;
  cursor: pointer;
  transition: 0.15s;
}
.holo-node:hover {
  fill: var(--gold);
  r: 8;
}

/* glow path */
.holo-path {
  stroke: var(--gold);
  stroke-width: 2px;
  fill: none;
  opacity: 0.7;
  filter: drop-shadow(0 0 6px var(--gold-soft));
  stroke-linecap: round;
  stroke-linejoin: round;
  animation: pathGlow 3s infinite alternate ease-in-out;
}

@keyframes pathGlow {
  0% { stroke-opacity: 0.4; }
  100% { stroke-opacity: 1; }
}

/* ============================================================
   CENTER PANEL — COMPONENT HOLO CARDS
   ============================================================ */
#components-panel {
  padding: 12px;
  background: rgba(8,8,12,0.6);
  backdrop-filter: blur(6px);
  overflow-y: auto;
}

#filters {
  display: grid;
  grid-template-columns: repeat(4,1fr);
  gap: 8px;
  margin-bottom: 12px;
}

.filter-input,
.filter-select {
  background: rgba(20,20,25,0.75);
  border: 1px solid var(--gold-faint);
  border-radius: 10px;
  padding: 6px 10px;
  color: var(--text);
  outline: none;
  transition: 0.2s;
}
.filter-input:focus,
.filter-select:focus {
  border-color: var(--gold);
  box-shadow: 0 0 8px var(--gold-soft);
  background: rgba(25,25,30,0.9);
}

/* holo cards */
.holo-card {
  background: linear-gradient(145deg, rgba(10,10,14,0.8), rgba(5,5,8,0.7));
  border: 1px solid var(--gold-faint);
  border-radius: var(--radius);
  padding: 12px;
  margin-bottom: 10px;
  backdrop-filter: blur(4px);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}
.holo-card:hover {
  border-color: var(--gold);
  box-shadow: 0 0 16px rgba(214,180,76,0.3);
  transform: translateY(-2px);
}

/* glitch hologram overlay */
.holo-card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(93,208,255,0.08) 40%,
    transparent 80%
  );
  mix-blend-mode: overlay;
  opacity: 0.0;
  animation: holoGlitch 6s infinite ease-in-out;
}
@keyframes holoGlitch {
  0% { opacity: 0.0; }
  50% { opacity: 0.15; }
  100% { opacity: 0.0; }
}

/* add to route */
.add-route-btn {
  margin-top: 8px;
  padding: 6px 10px;
  border-radius: 10px;
  background: rgba(214,180,76,0.15);
  color: var(--gold);
  border: 1px solid var(--gold-soft);
  cursor: pointer;
  transition: var(--transition);
}
.add-route-btn:hover {
  background: rgba(214,180,76,0.3);
}

/* ============================================================
   RIGHT PANEL — SHOPPING ROUTE PLANNER
   ============================================================ */
#route-panel {
  background: rgba(5,5,10,0.75);
  padding: 14px;
  border-left: 1px solid var(--gold-soft);
  backdrop-filter: blur(8px);
  overflow-y: auto;
}

#route-title {
  text-align: center;
  font-size: 1.3rem;
  color: var(--gold);
  margin-bottom: 10px;
  letter-spacing: 0.1em;
}

#selected-items {
  padding: 8px;
  background: rgba(20,20,25,0.7);
  border-radius: var(--radius);
  border: 1px solid var(--gold-faint);
  margin-bottom: 12px;
  min-height: 50px;
}

#generate-route-btn {
  width: 100%;
  padding: 10px;
  background: rgba(214,180,76,0.2);
  border: 1px solid var(--gold);
  color: var(--gold);
  border-radius: var(--radius);
  cursor: pointer;
  transition: var(--transition);
}
#generate-route-btn:hover {
  background: rgba(214,180,76,0.35);
  box-shadow: 0 0 18px var(--gold-soft);
}

#route-output {
  margin-top: 16px;
  padding: 10px;
  border-radius: var(--radius);
  background: rgba(15,15,20,0.7);
  border: 1px solid var(--gold-faint);
}

/* Stop card */
.route-stop {
  padding: 10px;
  margin-top: 10px;
  background: rgba(25,25,30,0.75);
  border: 1px solid var(--gold-soft);
  border-radius: var(--radius);
}

</style>
</head>

<body>
<div id="layout">

<!-- ============================================================
     LEFT PANEL — HOLOGRAPHIC MAP
     ============================================================ -->
<div id="holo-map-container">
  <div id="holo-map-title">STANTON HOLOGRAPHIC MAP</div>
  <svg id="holo-map" viewBox="-200 -200 400 400">
    <!-- Outer rings -->
    <circle cx="0" cy="0" r="40" stroke="var(--blue-holo-faint)" stroke-width="1" fill="none"></circle>
    <circle cx="0" cy="0" r="80" stroke="var(--blue-holo-faint)" stroke-width="1" fill="none"></circle>
    <circle cx="0" cy="0" r="130" stroke="var(--blue-holo-faint)" stroke-width="1" fill="none"></circle>

    <!-- Nodes populated dynamically -->
    <g id="map-nodes"></g>
    <g id="map-paths"></g>
  </svg>
</div>

<!-- ============================================================
     CENTER PANEL — HOLO CARDS
     ============================================================ -->
<div id="components-panel">

  <div id="filters">
    <input id="searchInput" class="filter-input" type="text" placeholder="Search name or manufacturer…">
    <select id="filterComponent" class="filter-select"><option value="">All Components</option></select>
    <select id="filterClass" class="filter-select"><option value="">All Classes</option></select>
    <select id="filterSize" class="filter-select"><option value="">All Sizes</option></select>
  </div>

  <div id="cards-render"></div>
</div>

<!-- ============================================================
     RIGHT PANEL — ROUTE PLANNER
     ============================================================ -->
<div id="route-panel">
  <div id="route-title">ROUTE PLANNER</div>

  <div id="selected-items"></div>

  <button id="generate-route-btn">Generate Best Route</button>

  <div id="route-output"></div>
</div>

</div><!-- layout end -->

<script>
/* ============================================================
   DATA FETCHING
   ============================================================ */
const componentsURL = "data/components.js";
const shopsURL = "data/shops.json";
const shopInvURL = "data/shop_inventory.json";

let components = [];
let shops = [];
let shopInventory = [];
let selectedItems = new Set();

/* Travel cost & penalty model */
const travelCost = {
  "Area18": 0,
  "Bajini Point": 1,
  "Everus Harbor": 1,
  "Seraphin": 1,

  "Port Tressler": 2,
  "CRU-L1": 2,
  "CRU-L2": 2,
  "MIC-L1": 2,
  "MIC-L2": 2,
  "HUR-L1": 2,
  "HUR-L2": 2,

  "Lorville": 3,
  "GrimHex": 3,

  "Orison": 8,
  "New Babbage": 6
};

/* Fetch all data */
Promise.all([
  fetch(componentsURL).then(r=>r.json()),
  fetch(shopsURL).then(r=>r.json()),
  fetch(shopInvURL).then(r=>r.json())
])
.then(([comp, shopList, shopInv])=>{
  components = comp;
  shops = shopList;
  shopInventory = shopInv;

  buildFilters();
  renderCards(components);
  renderMapNodes();
})
.catch(err=>{
  console.error("Data load error:", err);
});

/* ============================================================
   FILTERS
   ============================================================ */
function buildFilters(){
  const compSet = new Set();
  const classSet = new Set();
  const sizeSet = new Set();

  components.forEach(c=>{
    if(c.Component) compSet.add(c.Component);
    if(c.Class) classSet.add(c.Class);
    if(c.Size) sizeSet.add(c.Size);
  });

  for(const v of compSet){
    const o = document.createElement("option");
    o.value = v; o.textContent = v;
    filterComponent.appendChild(o);
  }
  for(const v of classSet){
    const o = document.createElement("option");
    o.value = v; o.textContent = v;
    filterClass.appendChild(o);
  }
  for(const v of sizeSet){
    const o = document.createElement("option");
    o.value = v; o.textContent = v;
    filterSize.appendChild(o);
  }

  searchInput.oninput =
  filterComponent.onchange =
  filterClass.onchange =
  filterSize.onchange = ()=>applyFilters();
}

function applyFilters(){
  const q = searchInput.value.toLowerCase();
  const fc = filterComponent.value;
  const fcl = filterClass.value;
  const fs = filterSize.value;

  const list = components.filter(c=>{
    if(fc && c.Component !== fc) return false;
    if(fcl && c.Class !== fcl) return false;
    if(fs && c.Size !== fs) return false;

    const hay = (c.Names+" "+c.Manufacturer).toLowerCase();
    return hay.includes(q);
  });

  renderCards(list);
}

/* ============================================================
   RENDER HOLO CARDS
   ============================================================ */
function renderCards(list){
  const out = [];
  for(const c of list){
    out.push(`
      <div class="holo-card">
        <div style="font-size:1.1rem;color:var(--gold);">${c.Names}</div>
        <div style="margin:6px 0;color:var(--text-soft);">
          ${c.Component} • ${c.Size} • Grade ${c.Grade} • ${c.Class}
        </div>
        <div style="font-size:0.9rem;color:var(--blue-holo);">
          Shops: ${(c.Shops||[]).join(", ")}
        </div>
        <button class="add-route-btn" onclick="addToRoute('${c.Names}')">
          Add to Route
        </button>
      </div>
    `);
  }
  document.getElementById("cards-render").innerHTML = out.join("");
}

/* ============================================================
   ROUTE PLANNER LOGIC
   ============================================================ */
function addToRoute(name){
  selectedItems.add(name);
  renderSelected();
}

function renderSelected(){
  document.getElementById("selected-items").innerHTML =
    [...selectedItems].map(i=>`<div>${i}</div>`).join("");
}

document.getElementById("generate-route-btn").onclick = ()=>{
  if(selectedItems.size === 0){
    alert("Select components first.");
    return;
  }
  const route = computeBestRoute([...selectedItems]);
  renderRoute(route);
  drawRouteOnMap(route);
};

/* Compute best route */
function computeBestRoute(want){

  /* Build location => items mapping */
  const locMap = {};
  for(const c of components){
    if(!want.includes(c.Names)) continue;
    if(!c.Shops) continue;
    for(const s of c.Shops){
      if(!locMap[s]) locMap[s] = new Set();
      locMap[s].add(c.Names);
    }
  }

  const locs = Object.keys(locMap);

  /* Try 1 stop */
  for(const a of locs){
    if(coversAll(locMap[a], want)) return [a];
  }

  /* Try 2 stops */
  let best2 = null;
  for(let i=0;i<locs.length;i++){
    for(let j=i+1;j<locs.length;j++){
      const cov = union(locMap[locs[i]], locMap[locs[j]]);
      if(coversAll(cov, want)){
        const cost = routeCost([locs[i], locs[j]]);
        if(!best2 || cost < best2.cost){
          best2 = {route:[locs[i], locs[j]], cost};
        }
      }
    }
  }
  if(best2) return best2.route;

  /* Try 3 stops */
  let best3 = null;
  for(let i=0;i<locs.length;i++){
    for(let j=i+1;j<locs.length;j++){
      for(let k=j+1;k<locs.length;k++){
        const cov = union3(locMap[locs[i]], locMap[locs[j]], locMap[locs[k]]);
        if(coversAll(cov, want)){
          const r = [locs[i], locs[j], locs[k]];
          const cost = routeCost(r);
          if(!best3 || cost < best3.cost){
            best3 = {route:r, cost};
          }
        }
      }
    }
  }
  if(best3) return best3.route;

  /* fallback */
  return ["Area18"];
}

function coversAll(set, want){
  for(const w of want){
    if(!set.has(w)) return false;
  }
  return true;
}

function union(a,b){
  const s = new Set(a);
  for(const x of b) s.add(x);
  return s;
}

function union3(a,b,c){
  const s = new Set(a);
  for(const x of b) s.add(x);
  for(const x of c) s.add(x);
  return s;
}

/* Route cost calculation */
function routeCost(route){
  let sum = 0;
  for(const r of route){
    sum += travelCost[r] ?? 5;
  }
  return sum;
}

/* ============================================================
   ROUTE OUTPUT
   ============================================================ */
function renderRoute(route){
  let html = `<div style="font-size:1.1rem;color:var(--gold);">Optimal Route (${route.length} Stops)</div>`;

  route.forEach((loc, i)=>{
    const items = components.filter(c=>c.Shops && c.Shops.includes(loc) && selectedItems.has(c.Names))
      .map(c=>c.Names);
    html += `
      <div class="route-stop">
        <div style="font-size:1.05rem;color:var(--gold);">${i+1}. ${loc}</div>
        <div style="margin-top:6px;color:var(--text-soft);">${items.join(", ")}</div>
      </div>
    `;
  });

  document.getElementById("route-output").innerHTML = html;
}

/* ============================================================
   HOLO MAP — NODES + ROUTE DRAWING
   ============================================================ */
const mapCoords = {
  "Area18": {x:40, y:0},
  "Bajini Point": {x:80, y:10},
  "Seraphin": {x:65, y:-25},
  "Everus Harbor": {x:55, y:40},
  "Port Tressler": {x:-30, y:-110},
  "Lorville": {x:-20, y:60},
  "GrimHex": {x:-80, y:-30},
  "New Babbage": {x:-50, y:-130},
  "Orison": {x:50, y:120}
};

function renderMapNodes(){
  const g = document.getElementById("map-nodes");
  const out = [];
  for(const loc in mapCoords){
    const p = mapCoords[loc];
    out.push(`
      <circle class="holo-node" cx="${p.x}" cy="${p.y}" r="6">
        <title>${loc}</title>
      </circle>
    `);
  }
  g.innerHTML = out.join("");
}

function drawRouteOnMap(route){
  const g = document.getElementById("map-paths");
  g.innerHTML = "";
  for(let i=0;i<route.length-1;i++){
    const a = mapCoords[route[i]];
    const b = mapCoords[route[i+1]];
    if(!a || !b) continue;
    g.innerHTML += `
      <line class="holo-path" x1="${a.x}" y1="${a.y}" x2="${b.x}" y2="${b.y}"></line>
    `;
  }
}

</script>
</body>
</html>
