<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>JMBN Mission Log</title>
<link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/png" href="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png" sizes="32x32">

<style>
:root{
  --bg:#000; --panel:#0b0b0b; --row:#0a0a0a;
  --border:#d6b44c; --accent:#f2d675; --text:#f7f1d0; --muted:#c9b06a;
  --fs-h1:clamp(18px,2.2vw,22px);
}
*{box-sizing:border-box}
body{
  background:#000;color:var(--text);
  font-family:'Play',system-ui,sans-serif;
  margin:0;padding:20px;
}

/* === Brand === */
.brand{
  display:flex;align-items:center;gap:10px;
  margin:0 0 8px;
  border-bottom:1px solid var(--border);
  padding-bottom:6px;
}
.brand-logo{
  width:44px;height:44px;object-fit:contain;
  filter:drop-shadow(0 0 4px rgba(242,214,117,.25));
}
.brand h1{
  margin:0;font-weight:700;
  font-size:var(--fs-h1);color:var(--accent);
}

/* === Shiny Nav Buttons === */
.nav{
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:6px 0 14px;
}
.nav-btn{
  --ring:#d6b44c;
  position:relative;display:inline-flex;align-items:center;justify-content:center;
  padding:7px 14px;border:1px solid var(--ring);border-radius:999px;
  background:linear-gradient(180deg,#0c0c0c,#060606);
  color:var(--accent);text-decoration:none;font-weight:700;letter-spacing:.2px;
  box-shadow:inset 0 0 0 1px rgba(214,180,76,.12);
  transition:transform .15s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
}
.nav-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 0 12px rgba(214,180,76,.25), inset 0 0 0 1px rgba(214,180,76,.18);
  background:linear-gradient(180deg,#1a1a1a,#0a0a0a);
  color:var(--accent);
}
.nav-btn.active{
  color:#000;
  background:
    radial-gradient(120% 120% at 80% -20%, rgba(255,255,255,.32), rgba(255,255,255,0) 40%),
    linear-gradient(180deg,#f2d675,#e7c760);
  border-color:var(--ring);
  box-shadow:0 0 20px rgba(214,180,76,.45), inset 0 1px 0 rgba(255,255,255,.25), inset 0 -1px 0 rgba(0,0,0,.12);
}
.nav-btn.active::after{
  content:"";position:absolute;inset:0;border-radius:inherit;
  background:linear-gradient(120deg,rgba(255,255,255,0) 30%,rgba(255,255,255,.32) 50%,rgba(255,255,255,0) 70%);
  transform:translateX(-120%); animation:shine 2.8s ease-in-out infinite; pointer-events:none;
}
@keyframes shine{0%{transform:translateX(-120%)}35%,100%{transform:translateX(120%)}}

/* === Toolbar === */
.toolbar{
  display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px;
}
.btn-cta{
  display:inline-flex;align-items:center;gap:8px;padding:8px 12px;
  border:1px solid var(--border);border-radius:12px;
  background:linear-gradient(180deg,#0c0c0c,#060606);
  color:var(--accent);text-decoration:none;font-weight:700;
}
.btn-cta:hover{background:linear-gradient(180deg,#f2d675,#e7c760);color:#000;}
input[type="search"]{
  width:260px;background:#0a0a0a;border:1px solid var(--border);
  border-radius:10px;padding:8px 10px;color:var(--text);
}
.subtle{color:var(--muted);font-size:12px}

/* === Table === */
.table-wrap{
  overflow:auto;border:1px solid var(--border);
  border-radius:12px;background:var(--panel);
  box-shadow:0 0 18px rgba(214,180,76,.12);
}
table{width:100%;border-collapse:collapse;min-width:1100px}
thead th{
  text-align:left;font-weight:700;color:var(--accent);
  padding:12px;border-bottom:1px solid var(--border);
  position:sticky;top:0;background:var(--panel);z-index:1;
}
tbody td{
  padding:12px;border-bottom:1px solid rgba(214,180,76,.25);vertical-align:top;
}
tbody tr:hover{background:#111;}

/* === Pills === */
.pill{
  display:inline-block;padding:4px 10px;border:1px solid var(--border);border-radius:999px;
  color:var(--accent);font-size:12px;background:#090909;
}
.link{
  color:var(--accent);text-decoration:underline;cursor:pointer;
}
.badge{
  border:1px solid var(--border);border-radius:999px;
  padding:2px 8px;font-size:11px;color:var(--muted);
}
.nowrap{white-space:nowrap}
.mono{font-variant-numeric:tabular-nums}
</style>
</head>
<body>

<!-- === Brand === -->
<div class="brand">
  <img class="brand-logo" src="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png" alt="JMBN">
  <h1>JMBN Mission Log</h1>
</div>

<!-- === Nav === -->
<nav class="nav">
  <a class="nav-btn" href="index.html">Manifest</a>
  <a class="nav-btn" href="hangar.html">Hangar</a>
  <a class="nav-btn" href="components.html">Components</a>
  <a class="nav-btn" href="contracts.html">Contracts</a>
  <a class="nav-btn active" href="mission-log.html">Mission Log</a>
</nav>

<!-- === Toolbar === -->
<div class="toolbar">
  <input id="search" type="search" placeholder="Search title / type / tags / status...">
  <span class="subtle">Click a rowâ€™s ID to open it for editing.</span>
</div>

<!-- === Table === -->
<div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Mission Title</th>
        <th>Type</th>
        <th>Status</th>
        <th>Origin</th>
        <th>Destination</th>
        <th class="nowrap">Date</th>
        <th class="nowrap">No. of Hours</th>
        <th class="nowrap">Payout (aUEC)</th>
        <th>Tags</th>
        <th>Attendees</th>
        <th>Attachments</th>
        <th>Notes</th>
        <th>ID</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<!-- === Supabase Mission Fetch === -->
<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const SUPABASE_URL  = 'https://fcegavhipeaeihxegsnw.supabase.co'
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZjZWdhdmhpcGVhZWloeGVnc253Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjk3NTcsImV4cCI6MjA3NzcwNTc1N30.i-ZjOlKc89-uA7fqOIvmAMv60-C2_NmKikRI_78Jei8'
const sb = createClient(SUPABASE_URL, SUPABASE_ANON)

const tbody = document.getElementById('tbody')
const search = document.getElementById('search')
let cache = []

const esc = (s='') => {const d=document.createElement('div'); d.textContent=s; return d.innerHTML;}
const fmtDate = iso => iso ? new Date(iso).toLocaleString() : ''
const fmtNum = n => (n||n===0) ? Number(n).toLocaleString() : ''
const pill = t => t ? `<span class="pill">${esc(t)}</span>` : ''

function attachmentsCell(arr){
  if(!Array.isArray(arr) || !arr.length) return ''
  return arr.map((a,i)=>{
    const name = a?.name?.trim() || `Attachment ${i+1}`
    const url  = a?.url || '#'
    return `<a class="link" href="${esc(url)}" target="_blank" rel="noopener">${esc(name)}</a>`
  }).join(', ')
}

function rowHtml(r){
  return `
    <tr>
      <td>${esc(r.title||'(untitled)')}</td>
      <td>${pill(r.type)}</td>
      <td>${pill(r.status)}</td>
      <td>${esc(r.origin||'')}</td>
      <td>${esc(r.destination||'')}</td>
      <td clas
