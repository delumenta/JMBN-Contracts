<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>JMBN Shopping Route Planner</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Play:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png"
        href="https://static.wixstatic.com/media/08ea88_820ac3bc561d4233ad73a7af859f28bf~mv2.png"
        sizes="32x32">

  <style>
    :root{
      --bg:#000;
      --panel:#0b0b0b;
      --sub:#101010;
      --row:#0a0a0a;
      --border:#d6b44c;
      --card:#141414;
      --accent:#f2d675;
      --text:#f7f1d0;
      --muted:#c9b06a;
      --bad:#ff6b6b;
      --good:#8be38b;
      --fs-base:14px;
      --fs-sm:12px;
      --fs-lg:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:#000;
      color:var(--text);
      font-family:'Play',sans-serif;
      padding:14px;
    }
    #header-container{
      margin-bottom:10px;
    }
    main{
      max-width:1200px;
      margin:0 auto;
    }

    .layout{
      display:grid;
      grid-template-columns:350px 1fr;
      gap:12px;
    }
    @media(max-width:900px){
      .layout{grid-template-columns:1fr}
    }

    .panel{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      box-shadow:0 0 18px rgba(214,180,76,.22), inset 0 0 0 1px rgba(214,180,76,.12);
    }

    /* form */
    .field{margin-bottom:10px}
    .label{font-size:var(--fs-sm);color:var(--muted);margin-bottom:4px}
    .input, .select{
      width:100%;
      background:#0a0a0a;
      border:1px solid var(--border);
      border-radius:8px;
      padding:8px;
      color:var(--text);
      font-family:inherit;
      outline:none;
    }
    .btn{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      background:#0c0c0c;
      color:var(--accent);
      cursor:pointer;
      transition:.15s;
      font-family:'Play',sans-serif;
      width:100%;
    }
    .btn:hover{
      background:var(--accent);
      color:#000;
      transform:translateY(-1px);
    }

    .list{
      max-height:300px;
      overflow:auto;
      border:1px solid rgba(214,180,76,.4);
      border-radius:8px;
      background:#050505;
      padding:8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .item-row{
      padding:8px;
      background:#0b0b0b;
      border-radius:8px;
      border:1px solid rgba(214,180,76,.3);
      cursor:pointer;
      transition:.15s;
    }
    .item-row:hover{background:#151515}

    .item-row.selected{
      background:#1e1a12;
      border-color:var(--accent);
    }

    /* output */
    .route-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:10px;
    }

    .route-card{
      background:#0c0c0c;
      border:1px solid rgba(214,180,76,.6);
      border-radius:12px;
      padding:10px;
    }

    .route-title{
      font-size:var(--fs-base);
      color:var(--accent);
      font-weight:700;
      border-bottom:1px solid rgba(214,180,76,.35);
      padding-bottom:4px;
      margin-bottom:4px;
    }

    .comp-line{
      font-size:var(--fs-sm);
      color:var(--muted);
      padding:3px 0;
      border-bottom:1px dashed rgba(214,180,76,.2);
    }

    .copy-box{
      margin-top:12px;
      border:1px solid rgba(214,180,76,.5);
      border-radius:8px;
      padding:8px;
    }
    .copy-box textarea{
      width:100%;
      background:#050505;
      border:1px solid rgba(214,180,76,.4);
      color:var(--text);
      border-radius:8px;
      padding:8px;
      resize:vertical;
      min-height:80px;
      font-family:'Play',monospace;
      font-size:11px;
    }
  </style>
</head>
<body>

<div id="header-container"></div>
<script>
(async () => {
  try{
    const res = await fetch('header.html');
    const html = await res.text();
    document.getElementById('header-container').outerHTML = html;

    // highlight nav
    requestAnimationFrame(()=>{
      const here=(location.pathname.split('/').pop()||'shopping.html').toLowerCase();
      document.querySelectorAll('.nav-btn').forEach(a=>{
        if(a.getAttribute('href')?.toLowerCase()===here){
          a.classList.add('active');
        }
      });
    });
  }catch(e){console.warn('Header load failed',e)}
})();
</script>

<main>
  <div class="layout">

    <!-- LEFT: component picking -->
    <section class="panel">
      <h2 style="color:var(--accent);margin-bottom:8px;">Shopping Planner</h2>

      <div class="field">
        <div class="label">Search components</div>
        <input id="searchInput" class="input" placeholder="XL-1, FR-76, DuraJet…">
      </div>

      <div id="compList" class="list"></div>

      <div style="margin-top:10px;display:flex;gap:8px;">
        <button id="generateBtn" class="btn">Generate Route</button>
        <button id="clearBtn" class="btn" style="background:#050505;color:var(--muted);">Clear</button>
      </div>
    </section>

    <!-- RIGHT: results -->
    <section class="panel">
      <h2 style="color:var(--accent);margin-bottom:8px;">Route Result</h2>
      <div id="output">
        <div style="color:var(--muted);font-size:var(--fs-sm);">
          Select components on the left and click <b>Generate Route</b>.
        </div>
      </div>

      <div id="copyBox" class="copy-box" style="display:none;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
          <span style="color:var(--muted);font-size:var(--fs-sm);">Shareable Summary</span>
          <button id="copyBtn" class="btn" style="padding:4px 8px;width:auto;">Copy</button>
        </div>
        <textarea id="copyText" readonly></textarea>
      </div>

    </section>
  </div>
</main>

<script>
  const DATA_URL='data/components.js';

  let master = [];
  let selected = new Set();

  const searchInput=document.getElementById('searchInput');
  const compList=document.getElementById('compList');
  const output=document.getElementById('output');
  const generateBtn=document.getElementById('generateBtn');
  const clearBtn=document.getElementById('clearBtn');
  const copyBox=document.getElementById('copyBox');
  const copyBtn=document.getElementById('copyBtn');
  const copyText=document.getElementById('copyText');

  function esc(t){
    const d=document.createElement('div');
    d.textContent=t??'';
    return d.innerHTML;
  }

  async function init(){
    try{
      const res=await fetch(DATA_URL,{cache:'no-store'});
      master = await res.json();
    }catch(e){ master=[]; }

    renderList();
  }

  function renderList(){
    const q = searchInput.value.trim().toLowerCase();
    let arr = master;

    if(q){
      arr = arr.filter(c =>
        (c.Names||'').toLowerCase().includes(q) ||
        (c.Component||'').toLowerCase().includes(q) ||
        (c.Manufacturer||'').toLowerCase().includes(q)
      );
    }

    compList.innerHTML = arr.map((c,i)=>{
      const id = c.Names;
      const sel = selected.has(id);
      return `
        <div class="item-row ${sel?'selected':''}" data-id="${esc(id)}">
          <div><b>${esc(c.Names)}</b> <span style="color:${sel?'#f2d675':'#c9b06a'};">(${esc(c.Component)})</span></div>
          <div style="font-size:12px;color:var(--muted);margin-top:2px;">${esc(c.Manufacturer||'')}</div>
        </div>
      `;
    }).join('');
  }

  compList.addEventListener('click', e=>{
    const row = e.target.closest('.item-row');
    if(!row) return;
    const id = row.dataset.id;
    if(selected.has(id)) selected.delete(id);
    else selected.add(id);
    renderList();
  });

  clearBtn.onclick=()=>{
    selected.clear();
    renderList();
    output.innerHTML=`<div style="color:var(--muted);font-size:var(--fs-sm);">Selection cleared.</div>`;
    copyBox.style.display='none';
  };

  generateBtn.onclick = ()=>{
    if(selected.size===0){
      output.innerHTML=`<div style="color:var(--bad);font-size:var(--fs-sm);">Pick at least one component.</div>`;
      copyBox.style.display='none';
      return;
    }
    generateRoute();
  };

  /* ===== Route planner ===== */
  function generateRoute(){
    const items = [...selected].map(id=> master.find(c=>c.Names===id));

    // Group components by WhereToBuy
    const map = new Map();
    for(const c of items){
      const w = (c.WhereToBuy || 'Unknown / Loot').trim();
      if(!map.has(w)) map.set(w, []);
      map.get(w).push(c);
    }

    // Sort shops by how many items they cover (best first)
    const shops = [...map.entries()].sort((a,b)=> b[1].length - a[1].length);

    let html = `
      <div style="margin-bottom:8px;">
        <span style="color:var(--accent);font-size:var(--fs-base);font-weight:700;">
          ${items.length} components, ${shops.length} stops
        </span>
      </div>
      <div class="route-grid">
    `;

    for(const [shop,list] of shops){
      html += `
        <div class="route-card">
          <div class="route-title">${esc(shop)}</div>
          ${list.map(c=>`
            <div class="comp-line">
              <b>${esc(c.Names)}</b> — ${esc(c.Component)}
              <br><span style="font-size:11px;color:var(--muted);">${esc(c.Manufacturer||'')}</span>
            </div>
          `).join('')}
        </div>
      `;
    }

    html += `</div>`; // end route-grid

    output.innerHTML = html;

    // Copy summary
    buildCopy(shops);
  }

  function buildCopy(shops){
    const lines=[];
    lines.push("JMBN Shopping Route");
    lines.push("----------------------");
    lines.push("");

    shops.forEach(([shop,list])=>{
      lines.push(`${shop} — ${list.length} item(s)`);
      list.forEach(c=>{
        lines.push(`  - ${c.Names} (${c.Component})`);
      });
      lines.push("");
    });

    copyText.value = lines.join("\n");
    copyBox.style.display='block';
  }

  copyBtn.onclick=async ()=>{
    try{
      await navigator.clipboard.writeText(copyText.value);
      copyBtn.textContent='Copied!';
      setTimeout(()=>copyBtn.textContent='Copy',1200);
    }catch{alert('Copy failed.')}
  };

  init();
</script>

</body>
</html>